<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GIP Framework: testsuite/tests/viewer.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GIP Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">testsuite/tests/viewer.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/***************************************************************************</span></div>
<div class="line"><span class="comment">    Generic Image Processing (GIP) Framework (Test Suite)</span></div>
<div class="line"><span class="comment">    A framework for developing image processing applications</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    See COPYRIGHT.txt for details.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    This framework is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    For the licensing terms refer to the file &#39;LICENSE&#39;.</span></div>
<div class="line"><span class="comment"> ***************************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;base/Application.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;base/Version.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;base/math/Vector3D.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;base/math/Matrix4x4.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;base/opengl/OpenGLContext.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;base/string/FormatOutputStream.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;base/string/StringOutputStream.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;base/ui/MessageDialog.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;base/ui/OpenFileDialog.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;base/ui/SaveFileDialog.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;gip/Version.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;gip/io/BMPEncoder.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;gip/io/JPEGEncoder.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;gip/io/PCXEncoder.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;gip/io/PNGEncoder.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;gip/io/TGAEncoder.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;gip/transformation/Convert.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;gip/transformation/LinearScale.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// TAG: remove onIdle from WindowImpl</span></div>
<div class="line"><span class="comment">// TAG: need IdleListener class for use with dispatch?</span></div>
<div class="line"><span class="comment">// TAG: need TimerListener?</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>com::azure::dev::gip;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Verbosity {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">      </div>
<div class="line">  <span class="keyword">enum</span> Value {</div>
<div class="line">    NO_INFORMATION,</div>
<div class="line">    WARNINGS,</div>
<div class="line">    NORMAL,</div>
<div class="line">    COMMANDS,</div>
<div class="line">    ACTIVE_MOUSE_EVENTS,</div>
<div class="line">    ALL_MOUSE_EVENTS,</div>
<div class="line">    EVERYTHING,</div>
<div class="line">    DEFAULT = EVERYTHING <span class="comment">// NORMAL</span></div>
<div class="line">  };</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Command {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">enum</span> {</div>
<div class="line">    NOTHING,</div>
<div class="line">        </div>
<div class="line">    SELECT_VERBOSITY_NO_INFORMATION,</div>
<div class="line">    SELECT_VERBOSITY_WARNINGS,</div>
<div class="line">    SELECT_VERBOSITY_NORMAL,</div>
<div class="line">    SELECT_VERBOSITY_COMMANDS,</div>
<div class="line">    SELECT_VERBOSITY_ACTIVE_MOUSE_EVENTS,</div>
<div class="line">    SELECT_VERBOSITY_ALL_MOUSE_EVENTS,</div>
<div class="line">    SELECT_VERBOSITY_EVERYTHING,</div>
<div class="line">    </div>
<div class="line">    OPEN_IMAGE,</div>
<div class="line">    SAVE_IMAGE,</div>
<div class="line">    </div>
<div class="line">    RENDER_DEFAULT,</div>
<div class="line">    RENDER_INTENSITY,</div>
<div class="line">    RENDER_RGB_CLOUD,</div>
<div class="line">    RESET_VIEW_PARAMETERS,</div>
<div class="line">    SHOW_OPENGL_INFORMATION, </div>
<div class="line">    HELP, </div>
<div class="line">    ABOUT, </div>
<div class="line">    QUIT, </div>
<div class="line">    SELECT_LOW_DETAIL,</div>
<div class="line">    SELECT_MEDIUM_DETAIL,</div>
<div class="line">    SELECT_HIGH_DETAIL,</div>
<div class="line">        </div>
<div class="line">    SHOW_FRAME_RATE,</div>
<div class="line">        </div>
<div class="line">    CYCLE_DISPLAY_MODE,</div>
<div class="line">        </div>
<div class="line">    CYCLE_SHADING_MODEL,</div>
<div class="line">    SELECT_SHADING_MODEL_FLAT,</div>
<div class="line">    SELECT_SHADING_MODEL_SMOOTH,</div>
<div class="line">        </div>
<div class="line">    CYCLE_POLYGON_MODE,</div>
<div class="line">    SELECT_POLYGON_MODE_FILL,</div>
<div class="line">    SELECT_POLYGON_MODE_LINE,</div>
<div class="line">    SELECT_POLYGON_MODE_POINT,</div>
<div class="line">        </div>
<div class="line">    BLENDING_ENABLE,</div>
<div class="line">    BLENDING_DISABLE,</div>
<div class="line">        </div>
<div class="line">    LIGHTING_ENABLE,</div>
<div class="line">    LIGHTING_DISABLE,</div>
<div class="line">        </div>
<div class="line">    ROTATE_AROUND_X_AXIS_NEG,</div>
<div class="line">    ROTATE_AROUND_X_AXIS_POS,</div>
<div class="line">    ROTATE_AROUND_Y_AXIS_NEG,</div>
<div class="line">    ROTATE_AROUND_Y_AXIS_POS,</div>
<div class="line">    ROTATE_AROUND_Z_AXIS_NEG,</div>
<div class="line">    ROTATE_AROUND_Z_AXIS_POS,</div>
<div class="line">        </div>
<div class="line">    TRANSLATE_ALONG_X_NEG,</div>
<div class="line">    TRANSLATE_ALONG_X_POS,</div>
<div class="line">    TRANSLATE_ALONG_Y_NEG,</div>
<div class="line">    TRANSLATE_ALONG_Y_POS,</div>
<div class="line">    TRANSLATE_ALONG_Z_NEG,</div>
<div class="line">    TRANSLATE_ALONG_Z_POS,</div>
<div class="line"> </div>
<div class="line">    SELECT_MODE_DEFAULT,</div>
<div class="line">    SELECT_MODE_SYSTEM,</div>
<div class="line">    SELECT_MODE_FLOOR,</div>
<div class="line">    SELECT_MODE_CUBE,</div>
<div class="line">    SELECT_MODE_CONE,</div>
<div class="line">    SELECT_MODE_TORUS,</div>
<div class="line">    SELECT_MODE_INTENSITY,</div>
<div class="line">    SELECT_MODE_RGB_CLOUD,</div>
<div class="line"> </div>
<div class="line">    SELECT_QUALITY_WORST,</div>
<div class="line">    SELECT_QUALITY_NORMAL,</div>
<div class="line">    SELECT_QUALITY_BEST</div>
<div class="line">  };</div>
<div class="line">};</div>
<div class="line">    </div>
<div class="line"><span class="keyword">class </span>ShadingModel {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">      </div>
<div class="line">  <span class="keyword">enum</span> Model {</div>
<div class="line">    FLAT,</div>
<div class="line">    SMOOTH,</div>
<div class="line">    FIRST_MODEL = FLAT,</div>
<div class="line">    LAST_MODEL = SMOOTH,</div>
<div class="line">    DEFAULT = FLAT</div>
<div class="line">  };</div>
<div class="line">};</div>
<div class="line">    </div>
<div class="line"><span class="keyword">class </span>PolygonMode {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">enum</span> Mode {</div>
<div class="line">    FILL,</div>
<div class="line">    LINE,</div>
<div class="line">    POINT,</div>
<div class="line">    FIRST_MODE = FILL,</div>
<div class="line">    LAST_MODE = POINT,</div>
<div class="line">    DEFAULT = FILL</div>
<div class="line">  };</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> Quality {</div>
<div class="line">  QUALITY_WORST,</div>
<div class="line">  QUALITY_NORMAL,</div>
<div class="line">  QUALITY_BEST</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> Mode {</div>
<div class="line">  MODE_BLACKNESS,</div>
<div class="line">  MODE_SYSTEM,</div>
<div class="line">  MODE_FLOOR,</div>
<div class="line">  MODE_CUBE,</div>
<div class="line">  MODE_CONE,</div>
<div class="line">  MODE_TORUS,</div>
<div class="line">  MODE_INTENSITY,</div>
<div class="line">  MODE_RGB_CLOUD,</div>
<div class="line">  MODE_DEFAULT = MODE_SYSTEM </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> DisplayMode {</div>
<div class="line">  DISPLAY_MODE_WINDOW,</div>
<div class="line">  DISPLAY_MODE_FULL_SCREEN,</div>
<div class="line">  DISPLAY_MODE_FIRST = DISPLAY_MODE_WINDOW,</div>
<div class="line">  DISPLAY_MODE_LAST = DISPLAY_MODE_FULL_SCREEN</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MyMenu : <span class="keyword">public</span> Menu {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">class </span>PolygonModeMenu : <span class="keyword">public</span> Menu {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    </div>
<div class="line">    PolygonModeMenu() throw(UserInterfaceException) {</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;Fill\tf&quot;</span>), Command::SELECT_POLYGON_MODE_FILL);</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;Line\tl&quot;</span>), Command::SELECT_POLYGON_MODE_LINE);</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;Point\tp&quot;</span>), Command::SELECT_POLYGON_MODE_POINT);</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">class </span>ShadingModelMenu : <span class="keyword">public</span> Menu {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    </div>
<div class="line">    ShadingModelMenu() throw(UserInterfaceException) {</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;Flat\tf&quot;</span>), Command::SELECT_SHADING_MODEL_FLAT);</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;Smooth\ts&quot;</span>), Command::SELECT_SHADING_MODEL_SMOOTH);</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">class </span>ModeMenu : <span class="keyword">public</span> Menu {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    </div>
<div class="line">    ModeMenu() throw(UserInterfaceException) {</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;System&quot;</span>), Command::SELECT_MODE_SYSTEM);</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;Floor&quot;</span>), Command::SELECT_MODE_FLOOR);</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;Cube&quot;</span>), Command::SELECT_MODE_CUBE);</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;C&amp;one&quot;</span>), Command::SELECT_MODE_CONE);</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;Torus&quot;</span>), Command::SELECT_MODE_TORUS);</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;Image&quot;</span>), Command::SELECT_MODE_INTENSITY);</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;RGB Cloud&quot;</span>), Command::SELECT_MODE_RGB_CLOUD);</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">class </span>QualityMenu : <span class="keyword">public</span> Menu {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    </div>
<div class="line">    QualityMenu() throw(UserInterfaceException) {</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;Worst&quot;</span>), Command::SELECT_QUALITY_WORST);</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;Normal&quot;</span>), Command::SELECT_QUALITY_NORMAL);</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;Best&quot;</span>), Command::SELECT_QUALITY_BEST);</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">class </span>VerbosityMenu : <span class="keyword">public</span> Menu {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    </div>
<div class="line">    VerbosityMenu() throw(UserInterfaceException) {</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;No information&quot;</span>), Command::SELECT_VERBOSITY_NO_INFORMATION);</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;Warnings&quot;</span>), Command::SELECT_VERBOSITY_WARNINGS);</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;Normal&quot;</span>), Command::SELECT_VERBOSITY_NORMAL);</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;Commands&quot;</span>), Command::SELECT_VERBOSITY_COMMANDS);</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;Active mouse events&quot;</span>), Command::SELECT_VERBOSITY_ACTIVE_MOUSE_EVENTS);</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;All mouse events&quot;</span>), Command::SELECT_VERBOSITY_ALL_MOUSE_EVENTS);</div>
<div class="line">      append(MESSAGE(<span class="stringliteral">&quot;&amp;Everything&quot;</span>), Command::SELECT_VERBOSITY_EVERYTHING);</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  </div>
<div class="line">  PolygonModeMenu polygonModeMenu;</div>
<div class="line">  ShadingModelMenu shadingModelMenu;</div>
<div class="line">  ModeMenu modeMenu;</div>
<div class="line">  QualityMenu qualityMenu;</div>
<div class="line">  VerbosityMenu verbosityMenu;</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  </div>
<div class="line">  MyMenu() throw(UserInterfaceException) {</div>
<div class="line">    append(MESSAGE(<span class="stringliteral">&quot;&amp;Open image...\t(C-o)&quot;</span>), Command::OPEN_IMAGE);</div>
<div class="line">    append(MESSAGE(<span class="stringliteral">&quot;&amp;Save image...\t(C-s)&quot;</span>), Command::SAVE_IMAGE);</div>
<div class="line">    appendMenu(MESSAGE(<span class="stringliteral">&quot;S&amp;hading model&quot;</span>), shadingModelMenu);</div>
<div class="line">    appendMenu(MESSAGE(<span class="stringliteral">&quot;&amp;Polygon mode&quot;</span>), polygonModeMenu);</div>
<div class="line">    appendMenu(MESSAGE(<span class="stringliteral">&quot;&amp;Mode&quot;</span>), modeMenu);</div>
<div class="line">    appendMenu(MESSAGE(<span class="stringliteral">&quot;&amp;Quality&quot;</span>), qualityMenu);</div>
<div class="line">    appendMenu(MESSAGE(<span class="stringliteral">&quot;&amp;Verbosity&quot;</span>), verbosityMenu);</div>
<div class="line">    append(MESSAGE(<span class="stringliteral">&quot;OpenGL information\t(C-a)&quot;</span>), Command::SHOW_OPENGL_INFORMATION);</div>
<div class="line">    append(MESSAGE(<span class="stringliteral">&quot;&amp;About\t(C-a)&quot;</span>), Command::ABOUT);</div>
<div class="line">    append(MESSAGE(<span class="stringliteral">&quot;&amp;Reset\t(C-r)&quot;</span>), Command::RESET_VIEW_PARAMETERS);</div>
<div class="line">    append(MESSAGE(<span class="stringliteral">&quot;&amp;Quit\t(C-q)&quot;</span>), Command::QUIT);</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>View {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    </div>
<div class="line">  Vector3D&lt;long double&gt; translation;</div>
<div class="line">  Vector3D&lt;long double&gt; rotation;</div>
<div class="line">  <span class="keywordtype">long</span> <span class="keywordtype">double</span> scale;</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    </div>
<div class="line">  <span class="keyword">inline</span> View() noexcept {</div>
<div class="line">    resetParameters();</div>
<div class="line">  }</div>
<div class="line">      </div>
<div class="line">  <span class="keyword">inline</span> <span class="keywordtype">void</span> resetParameters() noexcept {</div>
<div class="line">    setTranslation(Vector3D&lt;long double&gt;(0, 0, 0));</div>
<div class="line">    setRotation(Vector3D&lt;long double&gt;(0, 0, 0));</div>
<div class="line">    setScale(1);</div>
<div class="line">  }</div>
<div class="line">    </div>
<div class="line">  <span class="keyword">inline</span> Vector3D&lt;long double&gt; getTranslation() const noexcept {</div>
<div class="line">    <span class="keywordflow">return</span> translation;</div>
<div class="line">  }</div>
<div class="line">    </div>
<div class="line">  <span class="keyword">inline</span> <span class="keywordtype">void</span> setTranslation(<span class="keyword">const</span> Vector3D&lt;long double&gt;&amp; translation) noexcept {</div>
<div class="line">    this-&gt;translation = translation;</div>
<div class="line">  }</div>
<div class="line">    </div>
<div class="line">  <span class="keyword">inline</span> Vector3D&lt;long double&gt; getRotation() const noexcept {</div>
<div class="line">    <span class="keywordflow">return</span> rotation;</div>
<div class="line">  }</div>
<div class="line">    </div>
<div class="line">  <span class="keyword">inline</span> <span class="keywordtype">void</span> setRotation(<span class="keyword">const</span> Vector3D&lt;long double&gt;&amp; rotation) noexcept {</div>
<div class="line">    this-&gt;rotation = rotation;</div>
<div class="line">  }</div>
<div class="line">    </div>
<div class="line">  <span class="keyword">inline</span> <span class="keywordtype">long</span> <span class="keywordtype">double</span> getScale() const noexcept {</div>
<div class="line">    <span class="keywordflow">return</span> scale;</div>
<div class="line">  }</div>
<div class="line">      </div>
<div class="line">  <span class="keyword">inline</span> <span class="keywordtype">void</span> setScale(<span class="keywordtype">long</span> <span class="keywordtype">double</span> scale) noexcept {</div>
<div class="line">    this-&gt;scale = scale;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>EncoderRegistry : <span class="keyword">public</span> Object {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    </div>
<div class="line">  Map&lt;String, ImageEncoder*&gt; encoders;</div>
<div class="line">  Map&lt;String, String&gt; filters;</div>
<div class="line">    </div>
<div class="line">  BMPEncoder bmp;</div>
<div class="line">  JPEGEncoder jpeg;</div>
<div class="line">  PCXEncoder pcx;</div>
<div class="line">  PNGEncoder png;</div>
<div class="line">  TGAEncoder tga;</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">      </div>
<div class="line">  <span class="keywordtype">void</span> addEncoder(ImageEncoder* encoder) noexcept {</div>
<div class="line">    StringOutputStream stream;</div>
<div class="line">    Array&lt;String&gt; extensions = encoder-&gt;getExtensions();</div>
<div class="line">    Array&lt;String&gt;::ReadEnumerator enu = extensions.getReadEnumerator();</div>
<div class="line">    <span class="keywordflow">while</span> (enu.hasNext()) {</div>
<div class="line">      <span class="keyword">const</span> String* extension = enu.next();</div>
<div class="line">      <span class="keywordflow">if</span> (!encoders.hasKey(*extension)) {</div>
<div class="line">        encoders[*extension] = encoder;</div>
<div class="line">        stream &lt;&lt; MESSAGE(<span class="stringliteral">&quot;*.&quot;</span>) &lt;&lt; *extension &lt;&lt; <span class="charliteral">&#39;;&#39;</span> &lt;&lt; FLUSH;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    String filter = stream.getString();</div>
<div class="line">    filter.removeFrom(filter.getLength() - 1); <span class="comment">// remove last &#39;;&#39;</span></div>
<div class="line">    filters[filter] = encoder-&gt;getDescription() + MESSAGE(<span class="stringliteral">&quot; (&quot;</span>) + filter + MESSAGE(<span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">      </div>
<div class="line">  EncoderRegistry() noexcept {</div>
<div class="line">    filters[MESSAGE(<span class="stringliteral">&quot;*.*&quot;</span>)] = MESSAGE(<span class="stringliteral">&quot;All Files (*.*)&quot;</span>); <span class="comment">// TAG: dialog window should support this</span></div>
<div class="line">    addEncoder(&amp;bmp);</div>
<div class="line">    addEncoder(&amp;jpeg);</div>
<div class="line">    addEncoder(&amp;pcx);</div>
<div class="line">    addEncoder(&amp;png);</div>
<div class="line">    addEncoder(&amp;tga);</div>
<div class="line">  }</div>
<div class="line">      </div>
<div class="line">  Map&lt;String, String&gt; getFilters() const noexcept {</div>
<div class="line">    <span class="keywordflow">return</span> filters;</div>
<div class="line">  }</div>
<div class="line">      </div>
<div class="line">  ImageEncoder* getEncoderByName(<span class="keyword">const</span> String&amp; extension) noexcept {</div>
<div class="line">    <span class="keywordflow">if</span> (!encoders.hasKey(extension)) {</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">    ImageEncoder* encoder = encoders[extension];</div>
<div class="line">    <span class="keywordflow">return</span> encoder;</div>
<div class="line">  }</div>
<div class="line">      </div>
<div class="line">  ImageEncoder* getEncoder(<span class="keyword">const</span> String&amp; filename) noexcept {</div>
<div class="line">    <span class="keywordtype">int</span> index = filename.lastIndexOf(<span class="charliteral">&#39;.&#39;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (index &lt; 0) {</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">    String extension = filename.substring(index + 1);</div>
<div class="line">    <span class="keywordflow">if</span> (!encoders.hasKey(extension)) {</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">    ImageEncoder* encoder = encoders[extension];</div>
<div class="line">    <span class="keywordflow">return</span> encoder;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Renderable {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> update(<span class="keyword">const</span> View&amp; view) noexcept = 0;</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">virtual</span> ~Renderable() noexcept {</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>RenderIntensity : <span class="keyword">public</span> Renderable {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"> </div>
<div class="line">  OpenGL&amp; openGL;</div>
<div class="line">  ColorImage image;</div>
<div class="line">  OpenGL::ReserveDisplayLists displayLists;</div>
<div class="line">  Dimension dimension;</div>
<div class="line">  <span class="keywordtype">long</span> <span class="keywordtype">double</span> amplitude;</div>
<div class="line">  <span class="keywordtype">bool</span> mono;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> objectOffset;</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">class </span>Object {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">enum</span> {</div>
<div class="line">      INTENSITY</div>
<div class="line">    };</div>
<div class="line">  };</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> </div>
<div class="line">  RenderIntensity(OpenGL&amp; _openGL, <span class="keyword">const</span> ColorImage&amp; _image) noexcept</div>
<div class="line">    : openGL(_openGL),</div>
<div class="line">      image(_image),</div>
<div class="line">      displayLists(_openGL, 1) {</div>
<div class="line">    dimension = image.getDimension();</div>
<div class="line">    amplitude = 1.0;</div>
<div class="line">    mono = <span class="keyword">false</span>;</div>
<div class="line">    </div>
<div class="line"><span class="comment">//     openGL.glEnable(OpenGL::RESCALE_NORMAL);</span></div>
<div class="line"><span class="comment">//     openGL.glEnable(OpenGL::NORMALIZE);</span></div>
<div class="line"> </div>
<div class="line">    makeIntensity();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> makeIntensity() noexcept {</div>
<div class="line">    <span class="keyword">const</span> Dimension dimension = image.getDimension();</div>
<div class="line">    <span class="comment">// ColorImage* scaled = new ColorImage(dimension);</span></div>
<div class="line">    <span class="comment">// LinearScale scale(scaled, &amp;image);</span></div>
<div class="line">    <span class="comment">// scale();</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// GrayImage* gray = new GrayImage(scaled-&gt;getDimension());</span></div>
<div class="line">    <span class="comment">// Convert&lt;GrayImage, ColorImage, RGBToGray&gt; transform(gray, scaled, RGBToGray());</span></div>
<div class="line">    <span class="comment">// transform();</span></div>
<div class="line">    </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="namespacegip.html#a1d0985f6db537856ed8c7eef93b6fd68">ColorPixel</a>* src = image.getElements();</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="namespacegip.html#a1d0985f6db537856ed8c7eef93b6fd68">ColorPixel</a>* srcNextRow = src + dimension.getWidth();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> xOffset = -0.5 * dimension.getWidth();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> yOffset = -0.5 * dimension.getHeight();</div>
<div class="line">    {</div>
<div class="line">      OpenGL::DisplayList displayList(openGL, displayLists.getOffset() + Object::INTENSITY);</div>
<div class="line">      </div>
<div class="line">      <span class="keywordflow">if</span> (dimension.getHeight() == 0) {</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line">      </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y = 0; y &lt; (dimension.getHeight() - 1); ++y) {</div>
<div class="line">        OpenGL::Block block(openGL, OpenGL::TRIANGLE_STRIP);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x = 0; x &lt; dimension.getWidth(); ++x) {</div>
<div class="line">          Vector3D&lt;long double&gt; ac(</div>
<div class="line">            0,</div>
<div class="line">            1,</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(*srcNextRow)/16.0 -</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(*src)/16.0</div>
<div class="line">          );</div>
<div class="line">          Vector3D&lt;long double&gt; bc(</div>
<div class="line">            1,</div>
<div class="line">            0,</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(src[1])/16.0 -</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(*src)/16.0</div>
<div class="line">          );</div>
<div class="line">          Vector3D&lt;long double&gt; normal = ac.cross(bc);</div>
<div class="line">          normal /= normal.getModulus();</div>
<div class="line">          normal = Vector3D&lt;long double&gt;(0, 0, 1); <span class="comment">// TAG: temp fix</span></div>
<div class="line">          openGL.glNormal3f(normal.getX(), normal.getY(), normal.getZ());</div>
<div class="line">          </div>
<div class="line">          openGL.glColor4ub(</div>
<div class="line">            src-&gt;red,</div>
<div class="line">            src-&gt;green,</div>
<div class="line">            src-&gt;blue,</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(*src)</div>
<div class="line">          );</div>
<div class="line">          openGL.glVertex3f(</div>
<div class="line">            x + xOffset,</div>
<div class="line">            y + yOffset,</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(*src)/16.0</div>
<div class="line">          );</div>
<div class="line">          openGL.glColor4ub(</div>
<div class="line">            srcNextRow-&gt;red,</div>
<div class="line">            srcNextRow-&gt;green,</div>
<div class="line">            srcNextRow-&gt;blue,</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(*srcNextRow)</div>
<div class="line">          );</div>
<div class="line">          openGL.glVertex3f(</div>
<div class="line">            x + xOffset,</div>
<div class="line">            y+1 + yOffset,</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(*srcNextRow)/16.0</div>
<div class="line">          );</div>
<div class="line">          ++src;</div>
<div class="line">          openGL.glColor4ub(</div>
<div class="line">            src-&gt;red,</div>
<div class="line">            src-&gt;green,</div>
<div class="line">            src-&gt;blue,</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(*src)</div>
<div class="line">          );</div>
<div class="line">          openGL.glVertex3f(</div>
<div class="line">            x+1 + xOffset,</div>
<div class="line">            y + yOffset,</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(*src)/16.0</div>
<div class="line">          );</div>
<div class="line">          </div>
<div class="line">          Vector3D&lt;long double&gt; ac2(</div>
<div class="line">            -1,</div>
<div class="line">            0,</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(srcNextRow[1])/16.0 -</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(*srcNextRow)/16.0</div>
<div class="line">          );</div>
<div class="line">          Vector3D&lt;long double&gt; bc2(</div>
<div class="line">            -1,</div>
<div class="line">            -1,</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(srcNextRow[1])/16.0 -</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(*src)/16.0</div>
<div class="line">          );</div>
<div class="line">          Vector3D&lt;long double&gt; normal2 = ac2.cross(bc2);</div>
<div class="line">          normal2 /= normal2.getModulus();</div>
<div class="line">          normal2 = Vector3D&lt;long double&gt;(0, 0, 1); <span class="comment">// TAG: temp fix</span></div>
<div class="line">          openGL.glNormal3f(normal2.getX(), normal2.getY(), normal2.getZ());</div>
<div class="line">          </div>
<div class="line">          openGL.glColor4ub(</div>
<div class="line">            srcNextRow-&gt;red,</div>
<div class="line">            srcNextRow-&gt;green,</div>
<div class="line">            srcNextRow-&gt;blue,</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(*srcNextRow)</div>
<div class="line">          );</div>
<div class="line">          openGL.glVertex3f(</div>
<div class="line">            x + xOffset,</div>
<div class="line">            y+1 + yOffset,</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(*srcNextRow)/16.0</div>
<div class="line">          );</div>
<div class="line">          ++srcNextRow;</div>
<div class="line">          openGL.glColor4ub(</div>
<div class="line">            src-&gt;red,</div>
<div class="line">            src-&gt;green,</div>
<div class="line">            src-&gt;blue,</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(*src)</div>
<div class="line">          );</div>
<div class="line">          openGL.glVertex3f(</div>
<div class="line">            x+1 + xOffset,</div>
<div class="line">            y + yOffset,</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(*src)/16.0</div>
<div class="line">          );</div>
<div class="line">          openGL.glColor4ub(</div>
<div class="line">            srcNextRow-&gt;red,</div>
<div class="line">            srcNextRow-&gt;green,</div>
<div class="line">            srcNextRow-&gt;blue,</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(*srcNextRow)</div>
<div class="line">          );</div>
<div class="line">          openGL.glVertex3f(</div>
<div class="line">            x+1 + xOffset,</div>
<div class="line">            y+1 + yOffset,</div>
<div class="line">            convertPixel&lt;GrayPixel, ColorPixel&gt;(*srcNextRow)/16.0</div>
<div class="line">          );</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> setDimension(<span class="keyword">const</span> Dimension&amp; dimension) noexcept {</div>
<div class="line">    this-&gt;dimension = dimension;</div>
<div class="line">    makeIntensity();</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">void</span> setAmplitude(<span class="keywordtype">long</span> <span class="keywordtype">double</span> amplitude) noexcept {</div>
<div class="line">    this-&gt;amplitude = amplitude;</div>
<div class="line">    makeIntensity();</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">void</span> setMode() noexcept {</div>
<div class="line">    mono = <span class="keyword">true</span>;</div>
<div class="line">    makeIntensity();</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">void</span> update(<span class="keyword">const</span> View&amp; view) noexcept {</div>
<div class="line">    openGL.glClearColor(0.0, 0.0, 0.0, 1.0);</div>
<div class="line">    openGL.glClear(OpenGL::COLOR_BUFFER_BIT | OpenGL::DEPTH_BUFFER_BIT);</div>
<div class="line">    </div>
<div class="line">    openGL.glMatrixMode(OpenGL::MODELVIEW);</div>
<div class="line">    openGL.glLoadIdentity();</div>
<div class="line">    Vector3D&lt;long double&gt; translation = view.getTranslation();</div>
<div class="line">    openGL.glTranslatef(translation.getX(), translation.getY(), translation.getZ());</div>
<div class="line">    Vector3D&lt;long double&gt; rotation = view.getRotation();</div>
<div class="line">    openGL.glRotatef(rotation.getX(), 0.0, 1.0, 0.0);</div>
<div class="line">    openGL.glRotatef(rotation.getY(), 1.0, 0.0, 0.0);</div>
<div class="line">    openGL.glRotatef(rotation.getZ(), 0.0, 0.0, 1.0);</div>
<div class="line">    <span class="keywordtype">long</span> <span class="keywordtype">double</span> scale = amplitude * view.getScale() * 0.5;</div>
<div class="line">    openGL.glScalef(scale, scale, scale);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// displayLists.execute();</span></div>
<div class="line">    openGL.glCallList(displayLists.getOffset() + Object::INTENSITY);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  ~RenderIntensity() noexcept {</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>RenderRGBCloud : <span class="keyword">public</span> Renderable {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"> </div>
<div class="line">  OpenGL&amp; openGL;</div>
<div class="line">  ColorImage image;</div>
<div class="line">  OpenGL::ReserveDisplayLists displayLists;</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">class </span>Object {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">enum</span> {</div>
<div class="line">      RGB_CUBE,</div>
<div class="line">      RGB_CLOUD</div>
<div class="line">    };</div>
<div class="line">  };</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> </div>
<div class="line">  RenderRGBCloud(OpenGL&amp; _openGL, <span class="keyword">const</span> ColorImage&amp; _image) noexcept</div>
<div class="line">    : openGL(_openGL),</div>
<div class="line">      image(_image),</div>
<div class="line">      displayLists(_openGL, 2) {</div>
<div class="line">    </div>
<div class="line">    openGL.glLineWidth(1.5);</div>
<div class="line">    openGL.glPointSize(4.0);</div>
<div class="line">    openGL.glPolygonMode(OpenGL::FRONT, OpenGL::LINE);</div>
<div class="line">    openGL.glPolygonMode(OpenGL::BACK, OpenGL::LINE);</div>
<div class="line">    openGL.glShadeModel(OpenGL::SMOOTH);</div>
<div class="line">    openGL.glBlendFunc(OpenGL::SRC_ALPHA, OpenGL::ONE_MINUS_SRC_ALPHA);</div>
<div class="line">    </div>
<div class="line">    buildCube();</div>
<div class="line">    buildCloud();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> buildCube() noexcept {</div>
<div class="line">    OpenGL::DisplayList displayList(openGL, displayLists.getOffset() + Object::RGB_CUBE);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// RGB cube</span></div>
<div class="line">    openGL.glBegin(OpenGL::LINE_LOOP);</div>
<div class="line">    openGL.glColor3ub(0, 0, 0);</div>
<div class="line">    openGL.glVertex3f(-1, -1, -1);</div>
<div class="line">    openGL.glColor3ub(255,0,0);</div>
<div class="line">    openGL.glVertex3f(1, -1, -1);</div>
<div class="line">    openGL.glColor3ub(255, 255, 0);</div>
<div class="line">    openGL.glVertex3f(1, 1, -1);</div>
<div class="line">    openGL.glColor3ub(0, 255, 0);</div>
<div class="line">    openGL.glVertex3f(-1, 1, -1);</div>
<div class="line">    openGL.glEnd();</div>
<div class="line">    </div>
<div class="line">    openGL.glBegin(OpenGL::LINE_LOOP);</div>
<div class="line">    openGL.glColor3ub(0, 0, 255);</div>
<div class="line">    openGL.glVertex3f(-1, -1, 1);</div>
<div class="line">    openGL.glColor3ub(255, 0, 255);</div>
<div class="line">    openGL.glVertex3f(1, -1, 1);</div>
<div class="line">    openGL.glColor3ub(255, 255, 255);</div>
<div class="line">    openGL.glVertex3f(1, 1, 1);</div>
<div class="line">    openGL.glColor3ub(0, 255, 255);</div>
<div class="line">    openGL.glVertex3f(-1, 1, 1);</div>
<div class="line">    openGL.glEnd();</div>
<div class="line">    </div>
<div class="line">    openGL.glBegin(OpenGL::LINES);</div>
<div class="line">    openGL.glColor3ub(0, 0, 0);</div>
<div class="line">    openGL.glVertex3f(-1, -1, -1);</div>
<div class="line">    openGL.glColor3ub(0, 0, 255);</div>
<div class="line">    openGL.glVertex3f(-1, -1, 1);</div>
<div class="line">    openGL.glColor3ub(255, 0, 0);</div>
<div class="line">    openGL.glVertex3f(1, -1, -1);</div>
<div class="line">    openGL.glColor3ub(255, 0, 255);</div>
<div class="line">    openGL.glVertex3f(1, -1, 1);</div>
<div class="line">    openGL.glColor3ub(255, 255, 0);</div>
<div class="line">    openGL.glVertex3f(1, 1, -1);</div>
<div class="line">    openGL.glColor3ub(255, 255, 255);</div>
<div class="line">    openGL.glVertex3f(1, 1, 1);</div>
<div class="line">    openGL.glColor3ub(0, 255, 0);</div>
<div class="line">    openGL.glVertex3f(-1, 1, -1);</div>
<div class="line">    openGL.glColor3ub(0, 255, 255);</div>
<div class="line">    openGL.glVertex3f(-1, 1, 1);</div>
<div class="line">    openGL.glEnd();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">class </span>CloudOperation {</div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    </div>
<div class="line">    OpenGL&amp; openGL;</div>
<div class="line">    Allocator&lt;unsigned long&gt; lookup;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>* fastLookup;</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    </div>
<div class="line">    CloudOperation(OpenGL&amp; _openGL) noexcept</div>
<div class="line">      : openGL(_openGL),</div>
<div class="line">        lookup(256 * 256 * 256/<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)) {      </div>
<div class="line">      fill&lt;unsigned long&gt;(lookup.getElements(), 256 * 256 * 256/<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>), 0);</div>
<div class="line">      fastLookup = lookup.getElements();</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">inline</span> <span class="keywordtype">void</span> operator()(<span class="keyword">const</span> ColorPixel&amp; value) noexcept {</div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> colorIndex = value.rgb &amp; 0xffffff;</div>
<div class="line">      </div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>* colorGroup = fastLookup + colorIndex/<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> long);</div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> colorMask = 1 &lt;&lt; (colorIndex % <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> long));</div>
<div class="line">      </div>
<div class="line">      <span class="keywordflow">if</span> ((*colorGroup &amp; colorMask) == 0) {</div>
<div class="line">        *colorGroup |= colorMask;</div>
<div class="line">        openGL.glColor4ub(</div>
<div class="line">          value.red,</div>
<div class="line">          value.green,</div>
<div class="line">          value.blue,</div>
<div class="line">          128 <span class="comment">// (static_cast&lt;unsigned int&gt;(value.red) + value.green + value.blue + 1)/3</span></div>
<div class="line">        );</div>
<div class="line">        openGL.glVertex3f(</div>
<div class="line">          -1 + value.red * 2.0/255.0,</div>
<div class="line">          -1 + value.green * 2.0/255.0,</div>
<div class="line">          -1 + value.blue * 2.0/255.0</div>
<div class="line">        );</div>
<div class="line">        <span class="comment">// TAG: add noise &lt; 0.5</span></div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">void</span> buildCloud() noexcept {</div>
<div class="line">    CloudOperation cloudOperation(openGL);</div>
<div class="line">    OpenGL::DisplayList displayList(openGL, displayLists.getOffset() + Object::RGB_CLOUD);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// OpenGL::Block(openGL, OpenGL::POINTS);</span></div>
<div class="line">    openGL.glBegin(OpenGL::POINTS);      </div>
<div class="line">    <a class="code" href="namespacegip.html#a03c358773288fce89e6dad2bab7fa018">forEach</a>(image, cloudOperation);  </div>
<div class="line">    openGL.glEnd();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> onCommand(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> command) noexcept {</div>
<div class="line">    <span class="comment">// TAG: fixme</span></div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">void</span> update(<span class="keyword">const</span> View&amp; view) noexcept {</div>
<div class="line">    openGL.glClearColor(0.3f, 0.3f, 0.6f, 1.0f);</div>
<div class="line">    openGL.glClear(OpenGL::COLOR_BUFFER_BIT | OpenGL::DEPTH_BUFFER_BIT);</div>
<div class="line">    </div>
<div class="line">    openGL.glMatrixMode(OpenGL::MODELVIEW);</div>
<div class="line">    openGL.glLoadIdentity();</div>
<div class="line">    Vector3D&lt;long double&gt; translation = view.getTranslation();</div>
<div class="line">    openGL.glTranslatef(translation.getX(), translation.getY(), translation.getZ());</div>
<div class="line">    Vector3D&lt;long double&gt; rotation = view.getRotation();</div>
<div class="line">    openGL.glRotatef(rotation.getX(), 0.0, 1.0, 0.0);</div>
<div class="line">    openGL.glRotatef(rotation.getY(), 1.0, 0.0, 0.0);</div>
<div class="line">    openGL.glRotatef(rotation.getZ(), 0.0, 0.0, 1.0);</div>
<div class="line">    openGL.glScalef(view.getScale() * 0.5, view.getScale() * 0.5, view.getScale() * 0.5);</div>
<div class="line">    </div>
<div class="line">    openGL.glDisable(OpenGL::BLEND);</div>
<div class="line">    openGL.glCallList(displayLists.getOffset() + Object::RGB_CLOUD); <span class="comment">// render cloud</span></div>
<div class="line">    openGL.glEnable(OpenGL::BLEND);</div>
<div class="line">    </div>
<div class="line">    openGL.glDepthMask(<span class="keyword">false</span>);</div>
<div class="line">    openGL.glCallList(displayLists.getOffset() + Object::RGB_CUBE); <span class="comment">// render cube</span></div>
<div class="line">    openGL.glDepthMask(<span class="keyword">true</span>);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  ~RenderRGBCloud() noexcept {</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>ViewerApplication : <span class="keyword">public</span> Application {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> MAJOR_VERSION = 1;</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> MINOR_VERSION = 0;</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  </div>
<div class="line">  ViewerApplication() noexcept</div>
<div class="line">    : Application(MESSAGE(&quot;OpenGL Viewer&quot;)) {</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">class </span>MyOpenGLContext : <span class="keyword">public</span> OpenGLContext {</div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line"> </div>
<div class="line">    Verbosity::Value verbosity;</div>
<div class="line">    MyMenu menu;</div>
<div class="line">    DisplayMode displayMode;</div>
<div class="line">    Mode mode;</div>
<div class="line">    EncoderRegistry encoderRegistry;</div>
<div class="line">    OpenFileDialog openFile;</div>
<div class="line">    SaveFileDialog saveFile;</div>
<div class="line">    ColorImage image;</div>
<div class="line">    Renderable* renderable;</div>
<div class="line">    View view;</div>
<div class="line">    </div>
<div class="line">    ShadingModel::Model shadingModel;</div>
<div class="line">    PolygonMode::Mode polygonMode;</div>
<div class="line">    <span class="keywordtype">bool</span> blending;</div>
<div class="line">    <span class="keywordtype">bool</span> lighting;</div>
<div class="line">    </div>
<div class="line">    Vector3D&lt;long double&gt; translationBegin;</div>
<div class="line">    Vector3D&lt;long double&gt; rotationBegin;</div>
<div class="line">    <span class="keywordtype">long</span> <span class="keywordtype">double</span> scaleBegin;    </div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">long</span> <span class="keywordtype">double</span> orthoLeft;</div>
<div class="line">    <span class="keywordtype">long</span> <span class="keywordtype">double</span> orthoRight;</div>
<div class="line">    <span class="keywordtype">long</span> <span class="keywordtype">double</span> orthoBottom;</div>
<div class="line">    <span class="keywordtype">long</span> <span class="keywordtype">double</span> orthoTop;</div>
<div class="line">    <span class="keywordtype">long</span> <span class="keywordtype">double</span> orthoNear;</div>
<div class="line">    <span class="keywordtype">long</span> <span class="keywordtype">double</span> orthoFar;</div>
<div class="line">    </div>
<div class="line">    Position mouseButtonPosition;</div>
<div class="line">    <span class="keywordtype">bool</span> mouseLeftButtonPressed;</div>
<div class="line">    <span class="keywordtype">bool</span> mouseMiddleButtonPressed;</div>
<div class="line">    <span class="keywordtype">bool</span> mouseRightButtonPressed;</div>
<div class="line">    </div>
<div class="line">    Vector3D&lt;long double&gt; drag;</div>
<div class="line">    Matrix4x4&lt;OpenGL::GLdouble&gt; modelViewMatrix;</div>
<div class="line">    Matrix4x4&lt;OpenGL::GLdouble&gt; invertedModelViewMatrix;</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">enum</span> Object {</div>
<div class="line">      OBJECT_SYSTEM = 1,</div>
<div class="line">      OBJECT_FLOOR,</div>
<div class="line">      OBJECT_CUBE,</div>
<div class="line">      OBJECT_CONE,</div>
<div class="line">      OBJECT_TORUS</div>
<div class="line">    };</div>
<div class="line">    </div>
<div class="line">    MyOpenGLContext(</div>
<div class="line">      <span class="keyword">const</span> String&amp; title,</div>
<div class="line">      <span class="keyword">const</span> Position&amp; position,</div>
<div class="line">      <span class="keyword">const</span> Dimension&amp; dimension,</div>
<div class="line">      <span class="keyword">const</span> Format&amp; format) <span class="keywordflow">throw</span>(UserInterfaceException)</div>
<div class="line">      : OpenGLContext(position, dimension, format),</div>
<div class="line">        verbosity(Verbosity::DEFAULT),</div>
<div class="line">        mode(MODE_DEFAULT),</div>
<div class="line">        renderable(0) {</div>
<div class="line">      </div>
<div class="line">      setTitle(title);</div>
<div class="line">      setIconTitle(title);</div>
<div class="line">      </div>
<div class="line">      openFile.setFilters(encoderRegistry.getFilters());</div>
<div class="line">      openFile.setTitle(MESSAGE(<span class="stringliteral">&quot;Open image...&quot;</span>));</div>
<div class="line">      saveFile.setFilters(encoderRegistry.getFilters());</div>
<div class="line">      saveFile.setTitle(MESSAGE(<span class="stringliteral">&quot;Save image...&quot;</span>));</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// clear initial image</span></div>
<div class="line">      </div>
<div class="line">      openGL.glPolygonMode(OpenGL::FRONT_AND_BACK, OpenGL::FILL);</div>
<div class="line">      </div>
<div class="line">      <span class="keyword">static</span> <span class="keyword">const</span> OpenGL::GLfloat materialAmbient[] = {1.0, 1.0, 1.0, 1.0};</div>
<div class="line">      <span class="keyword">static</span> <span class="keyword">const</span> OpenGL::GLfloat materialSpecular[] = {0.25, 0.25, 0.25, 0.25};</div>
<div class="line">      <span class="keyword">static</span> <span class="keyword">const</span> OpenGL::GLfloat materialShininess[] = {10.0};</div>
<div class="line">      <span class="keyword">static</span> <span class="keyword">const</span> OpenGL::GLfloat materialEmission[] = {1.0, 0.0, 0.0, 0.0};</div>
<div class="line">        </div>
<div class="line">      openGL.glMaterialfv(OpenGL::FRONT_AND_BACK, OpenGL::AMBIENT, materialAmbient);</div>
<div class="line">      openGL.glMaterialfv(OpenGL::FRONT_AND_BACK, OpenGL::SPECULAR, materialSpecular);</div>
<div class="line">      openGL.glMaterialfv(OpenGL::FRONT_AND_BACK, OpenGL::SHININESS, materialShininess);</div>
<div class="line">      openGL.glMaterialfv(OpenGL::FRONT_AND_BACK, OpenGL::EMISSION, materialEmission);</div>
<div class="line">      </div>
<div class="line">      <span class="keyword">static</span> <span class="keyword">const</span> OpenGL::GLfloat lightModelAmbient[] = {0.0, 0.0, 0.0, 0.0};</div>
<div class="line">      </div>
<div class="line">      openGL.glLightModelfv(OpenGL::LIGHT_MODEL_AMBIENT, lightModelAmbient);</div>
<div class="line">      openGL.glLightModeli(OpenGL::LIGHT_MODEL_LOCAL_VIEWER, <span class="keyword">false</span>);</div>
<div class="line">      openGL.glLightModeli(OpenGL::LIGHT_MODEL_TWO_SIDE, <span class="keyword">false</span>);</div>
<div class="line">      </div>
<div class="line">      <span class="keyword">static</span> <span class="keyword">const</span> OpenGL::GLfloat lightAmbient[] = {0.5, 0.5, 0.5, 0.0};</div>
<div class="line">      <span class="keyword">static</span> <span class="keyword">const</span> OpenGL::GLfloat lightDiffuse[] = {0.25, 0.25, 0.25, 1.0};</div>
<div class="line">      <span class="keyword">static</span> <span class="keyword">const</span> OpenGL::GLfloat lightSpecular[] = {0.25, 0.25, 0.25, 1.0};</div>
<div class="line">      <span class="keyword">static</span> <span class="keyword">const</span> OpenGL::GLfloat lightPosition[] = {10.0, 10.0, 10.0, 0.0};</div>
<div class="line">      </div>
<div class="line">      openGL.glLightfv(OpenGL::LIGHT0, OpenGL::AMBIENT, lightAmbient);</div>
<div class="line">      openGL.glLightfv(OpenGL::LIGHT0, OpenGL::DIFFUSE, lightDiffuse);</div>
<div class="line">      openGL.glLightfv(OpenGL::LIGHT0, OpenGL::SPECULAR, lightSpecular);</div>
<div class="line">      openGL.glLightfv(OpenGL::LIGHT0, OpenGL::POSITION, lightPosition); <span class="comment">// uses current model-view matrix</span></div>
<div class="line">      openGL.glEnable(OpenGL::LIGHT0);</div>
<div class="line"> </div>
<div class="line">      openGL.glColorMaterial(OpenGL::BACK, OpenGL::AMBIENT);</div>
<div class="line">      openGL.glColorMaterial(OpenGL::FRONT, OpenGL::EMISSION);</div>
<div class="line">      openGL.glEnable(OpenGL::COLOR_MATERIAL);</div>
<div class="line"> </div>
<div class="line">      <span class="comment">//openGL.glEnable(OpenGL::MULTISAMPLE); // OpenGL 1.3</span></div>
<div class="line">      </div>
<div class="line">      openGL.glEnable(OpenGL::DEPTH_TEST);</div>
<div class="line">      <span class="comment">// openGL.glDepthFunc(OpenGL::LEQUAL); // TAG: fixme</span></div>
<div class="line"> </div>
<div class="line">      mode = MODE_TORUS;</div>
<div class="line">      setQuality(QUALITY_NORMAL);</div>
<div class="line">      shadingModel = ShadingModel::FLAT;</div>
<div class="line">      openGL.glShadeModel(OpenGL::FLAT);</div>
<div class="line">      polygonMode = PolygonMode::FILL;</div>
<div class="line">      openGL.glPolygonMode(OpenGL::FRONT_AND_BACK, OpenGL::FILL);</div>
<div class="line">      blending = <span class="keyword">false</span>;</div>
<div class="line">      openGL.glDisable(OpenGL::BLEND);</div>
<div class="line">      lighting = <span class="keyword">true</span>;</div>
<div class="line">      openGL.glEnable(OpenGL::LIGHTING);</div>
<div class="line">      </div>
<div class="line">      drag = Vector3D&lt;long double&gt;(0, 0, 0);</div>
<div class="line">      </div>
<div class="line">      mouseLeftButtonPressed = <span class="keyword">false</span>;</div>
<div class="line">      mouseMiddleButtonPressed = <span class="keyword">false</span>;</div>
<div class="line">      mouseRightButtonPressed = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">      makeSystem();</div>
<div class="line">      makeFloor();</div>
<div class="line">      makeCube();</div>
<div class="line">      makeCone();</div>
<div class="line">      makeTorus();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ~MyOpenGLContext() noexcept {</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> setQuality(Quality quality) noexcept {</div>
<div class="line">      <span class="comment">// TAG: need attribute</span></div>
<div class="line">      <span class="keywordflow">switch</span> (quality) {</div>
<div class="line">      <span class="keywordflow">case</span> QUALITY_WORST:</div>
<div class="line">        <span class="comment">// fastest</span></div>
<div class="line">        openGL.glHint(OpenGL::PERSPECTIVE_CORRECTION_HINT, OpenGL::FASTEST);</div>
<div class="line">        openGL.glHint(OpenGL::POINT_SMOOTH_HINT, OpenGL::FASTEST);</div>
<div class="line">        openGL.glHint(OpenGL::LINE_SMOOTH_HINT, OpenGL::FASTEST);</div>
<div class="line">        openGL.glHint(OpenGL::POLYGON_SMOOTH_HINT, OpenGL::FASTEST);</div>
<div class="line">        openGL.glDisable(OpenGL::POINT_SMOOTH);</div>
<div class="line">        openGL.glDisable(OpenGL::LINE_SMOOTH);</div>
<div class="line">        openGL.glDisable(OpenGL::POLYGON_SMOOTH);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> QUALITY_NORMAL:</div>
<div class="line">        <span class="comment">// ok</span></div>
<div class="line">        openGL.glHint(OpenGL::PERSPECTIVE_CORRECTION_HINT, OpenGL::DONT_CARE);</div>
<div class="line">        openGL.glHint(OpenGL::POINT_SMOOTH_HINT, OpenGL::DONT_CARE);</div>
<div class="line">        openGL.glHint(OpenGL::LINE_SMOOTH_HINT, OpenGL::DONT_CARE);</div>
<div class="line">        openGL.glHint(OpenGL::POLYGON_SMOOTH_HINT, OpenGL::DONT_CARE);</div>
<div class="line">        openGL.glDisable(OpenGL::POINT_SMOOTH);</div>
<div class="line">        openGL.glDisable(OpenGL::LINE_SMOOTH);</div>
<div class="line">        openGL.glDisable(OpenGL::POLYGON_SMOOTH);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> QUALITY_BEST:</div>
<div class="line">        openGL.glHint(OpenGL::PERSPECTIVE_CORRECTION_HINT, OpenGL::NICEST);</div>
<div class="line">        openGL.glHint(OpenGL::POINT_SMOOTH_HINT, OpenGL::NICEST);</div>
<div class="line">        openGL.glHint(OpenGL::LINE_SMOOTH_HINT, OpenGL::NICEST);</div>
<div class="line">        openGL.glHint(OpenGL::POLYGON_SMOOTH_HINT, OpenGL::NICEST);</div>
<div class="line">        openGL.glEnable(OpenGL::POINT_SMOOTH);</div>
<div class="line">        openGL.glEnable(OpenGL::LINE_SMOOTH);</div>
<div class="line">        openGL.glEnable(OpenGL::POLYGON_SMOOTH);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      invalidate();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">inline</span> <span class="keywordtype">void</span> setVerbosity(Verbosity::Value verbosity) noexcept {</div>
<div class="line">      this-&gt;verbosity = verbosity;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> setTranslation(<span class="keyword">const</span> Vector3D&lt;long double&gt;&amp; translation) noexcept {</div>
<div class="line">      view.setTranslation(translation);</div>
<div class="line">      invalidate();</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> setRotation(<span class="keyword">const</span> Vector3D&lt;long double&gt;&amp; rotation) noexcept {</div>
<div class="line">      view.setRotation(rotation);</div>
<div class="line">      invalidate();</div>
<div class="line">    }</div>
<div class="line">      </div>
<div class="line">    <span class="keywordtype">void</span> setScale(<span class="keywordtype">long</span> <span class="keywordtype">double</span> scale) noexcept {</div>
<div class="line">      view.setScale(scale);</div>
<div class="line">      invalidate();</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> resetViewParameters() noexcept {</div>
<div class="line">      view.setTranslation(Vector3D&lt;long double&gt;(0, 0, 0));</div>
<div class="line">      view.setRotation(Vector3D&lt;long double&gt;(0, 0, 0));</div>
<div class="line">      view.setScale(1);</div>
<div class="line">      invalidate();</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> setShadingModel(ShadingModel::Model shadingModel) noexcept {</div>
<div class="line">      <span class="keywordflow">if</span> (shadingModel != this-&gt;shadingModel) {</div>
<div class="line">        this-&gt;shadingModel = shadingModel;</div>
<div class="line">        <span class="keywordflow">switch</span> (shadingModel) {</div>
<div class="line">        <span class="keywordflow">case</span> ShadingModel::SMOOTH:</div>
<div class="line">          openGL.glShadeModel(OpenGL::SMOOTH);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> ShadingModel::FLAT:</div>
<div class="line">          openGL.glShadeModel(OpenGL::FLAT);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        invalidate();</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> setPolygonMode(PolygonMode::Mode polygonMode) noexcept {</div>
<div class="line">      <span class="keywordflow">if</span> (polygonMode != this-&gt;polygonMode) {</div>
<div class="line">        this-&gt;polygonMode = polygonMode;</div>
<div class="line">        <span class="keywordflow">switch</span> (polygonMode) {</div>
<div class="line">        <span class="keywordflow">case</span> PolygonMode::FILL:</div>
<div class="line">          openGL.glPolygonMode(OpenGL::FRONT_AND_BACK, OpenGL::FILL);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> PolygonMode::LINE:</div>
<div class="line">          openGL.glPolygonMode(OpenGL::FRONT_AND_BACK, OpenGL::LINE);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> PolygonMode::POINT:</div>
<div class="line">          openGL.glPolygonMode(OpenGL::FRONT_AND_BACK, OpenGL::POINT);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        invalidate();</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> setBlending(<span class="keywordtype">bool</span> blending) noexcept {</div>
<div class="line">      <span class="keywordflow">if</span> (blending != this-&gt;blending) {</div>
<div class="line">        this-&gt;blending = blending;</div>
<div class="line">        <span class="keywordflow">if</span> (blending) {</div>
<div class="line">          openGL.glEnable(OpenGL::BLEND);</div>
<div class="line">          openGL.glBlendColor(1.0, 1.0, 1.0, 0.5);</div>
<div class="line">          openGL.glBlendFunc(OpenGL::SRC_ALPHA, OpenGL::ONE);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">          openGL.glDisable(OpenGL::BLEND);</div>
<div class="line">        }</div>
<div class="line">        invalidate();</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> setLighting(<span class="keywordtype">bool</span> lighting) noexcept {</div>
<div class="line">      <span class="keywordflow">if</span> (lighting != this-&gt;lighting) {</div>
<div class="line">        this-&gt;lighting = lighting;</div>
<div class="line">        <span class="keywordflow">if</span> (lighting) {</div>
<div class="line">          openGL.glEnable(OpenGL::LIGHTING);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">          openGL.glDisable(OpenGL::LIGHTING);</div>
<div class="line">        }</div>
<div class="line">        invalidate();</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> setMode(Mode mode) noexcept {</div>
<div class="line">      <span class="keywordflow">if</span> (renderable) {</div>
<div class="line">        <span class="keyword">delete</span> renderable;</div>
<div class="line">      }</div>
<div class="line">      renderable = 0;</div>
<div class="line">      <span class="keywordflow">switch</span> (mode) {</div>
<div class="line">      <span class="keywordflow">case</span> MODE_INTENSITY:</div>
<div class="line">        setRenderable(<span class="keyword">new</span> RenderIntensity(openGL, image));</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> MODE_RGB_CLOUD:</div>
<div class="line">        setRenderable(<span class="keyword">new</span> RenderRGBCloud(openGL, image));</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      this-&gt;mode = mode;</div>
<div class="line">      invalidate();</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    Vector3D&lt;long double&gt; mapXYToWorld(<span class="keyword">const</span> Position&amp; position, <span class="keyword">const</span> <span class="keywordtype">int</span> viewPort[4]) <span class="keyword">const</span> noexcept {</div>
<div class="line">      <span class="keywordtype">long</span> <span class="keywordtype">double</span> tempX =</div>
<div class="line">        <span class="keyword">static_cast&lt;</span><span class="keywordtype">long</span> <span class="keywordtype">double</span><span class="keyword">&gt;</span>(position.getX() - viewPort[0])/</div>
<div class="line">        <span class="keyword">static_cast&lt;</span><span class="keywordtype">long</span> <span class="keywordtype">double</span><span class="keyword">&gt;</span>(viewPort[2]);</div>
<div class="line">      <span class="keywordtype">long</span> <span class="keywordtype">double</span> tempY =</div>
<div class="line">        <span class="keyword">static_cast&lt;</span><span class="keywordtype">long</span> <span class="keywordtype">double</span><span class="keyword">&gt;</span>(position.getY() - viewPort[1])/</div>
<div class="line">        <span class="keyword">static_cast&lt;</span><span class="keywordtype">long</span> <span class="keywordtype">double</span><span class="keyword">&gt;</span>(viewPort[3]);</div>
<div class="line">      <span class="keywordflow">return</span> Vector3D&lt;long double&gt;(</div>
<div class="line">        orthoLeft + tempX * (orthoRight - orthoLeft),</div>
<div class="line">        orthoTop + tempY * (orthoBottom - orthoTop),</div>
<div class="line">        orthoNear</div>
<div class="line">      );</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> makeSystem() noexcept {</div>
<div class="line">      OpenGL::DisplayList displayList(openGL, OBJECT_SYSTEM);</div>
<div class="line"> </div>
<div class="line">      openGL.glColorMaterial(OpenGL::BACK, OpenGL::AMBIENT);</div>
<div class="line">      openGL.glColorMaterial(OpenGL::FRONT, OpenGL::EMISSION);</div>
<div class="line">      openGL.glEnable(OpenGL::COLOR_MATERIAL);      </div>
<div class="line">      </div>
<div class="line">      openGL.glScalef(10 * 0.5, 10 * 0.5, 10 * 0.5);</div>
<div class="line">      openGL.glColor4f(1.0, 0.0, 0.0, 1.0);</div>
<div class="line">      openGL.cylinder(0.25, 0.25, 2, 16, 1);</div>
<div class="line">      openGL.glTranslatef(0, 0, 2);</div>
<div class="line">      openGL.cone(0.5, 1.0, 16, 1);</div>
<div class="line">      openGL.glTranslatef(0, 0, -2);</div>
<div class="line">      openGL.glRotatef(90, 1.0, 0.0, 0.0); <span class="comment">// x axis</span></div>
<div class="line">      openGL.glColor4f(0.0, 1.0, 0.0, 1.0);</div>
<div class="line">      openGL.cylinder(0.25, 0.25, 2, 16, 1);</div>
<div class="line">      openGL.glTranslatef(0, 0, 2);</div>
<div class="line">      openGL.cone(0.5, 1.0, 16, 1);</div>
<div class="line">      openGL.glTranslatef(0, 0, -2);</div>
<div class="line">      openGL.glRotatef(90, 0.0, 1.0, 0.0); <span class="comment">// y axis</span></div>
<div class="line">      openGL.glColor4f(0.0, 0.0, 1.0, 1.0);</div>
<div class="line">      openGL.cylinder(0.25, 0.25, 2, 16, 1);</div>
<div class="line">      openGL.glTranslatef(0, 0, 2);</div>
<div class="line">      openGL.cone(0.5, 1.0, 16, 1);</div>
<div class="line"> </div>
<div class="line">      openGL.glDisable(OpenGL::COLOR_MATERIAL);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> makeFloor() noexcept {</div>
<div class="line">      OpenGL::DisplayList displayList(openGL, OBJECT_FLOOR);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> makeCube() noexcept {</div>
<div class="line">      OpenGL::DisplayList displayList(openGL, OBJECT_CUBE);</div>
<div class="line">      </div>
<div class="line">      openGL.glColorMaterial(OpenGL::FRONT, OpenGL::EMISSION);</div>
<div class="line">      openGL.glEnable(OpenGL::COLOR_MATERIAL);</div>
<div class="line">      openGL.glColor4f(0.0, 1.0, 0.0, 0.75);</div>
<div class="line">      </div>
<div class="line">      {</div>
<div class="line">        OpenGL::Block block(openGL, OpenGL::QUAD_STRIP); <span class="comment">// draw the sides of the cube</span></div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Normal A</span></div>
<div class="line">        openGL.glNormal3f(0.0, 0.0, -1.0);</div>
<div class="line">        </div>
<div class="line">        openGL.glVertex3i(3, 3, -3); <span class="comment">// vertex 1</span></div>
<div class="line">        openGL.glVertex3i(3, -3, -3); <span class="comment">// vertex 2</span></div>
<div class="line">        openGL.glVertex3i(-3, 3, -3); <span class="comment">// vertex 3</span></div>
<div class="line">        openGL.glVertex3i(-3, -3, -3); <span class="comment">// vertex 4</span></div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Normal B</span></div>
<div class="line">        openGL.glNormal3f(-1.0, 0.0, 0.0);</div>
<div class="line">        openGL.glVertex3i(-3, 3, 3); <span class="comment">// vertex 5</span></div>
<div class="line">        openGL.glVertex3i(-3, -3, 3); <span class="comment">// vertex 6</span></div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Normal C</span></div>
<div class="line">        openGL.glNormal3f(0.0, 0.0, 1.0);</div>
<div class="line">        openGL.glVertex3i(3, 3, 3); <span class="comment">// vertex 7</span></div>
<div class="line">        openGL.glVertex3i(3, -3, 3); <span class="comment">// vertex 8</span></div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Normal D</span></div>
<div class="line">        openGL.glNormal3f(1.0, 0.0, 0.0);</div>
<div class="line">        openGL.glVertex3i(3, 3, -3); <span class="comment">// vertex 9</span></div>
<div class="line">        openGL.glVertex3i(3, -3, -3); <span class="comment">// vertex 10</span></div>
<div class="line">      }</div>
<div class="line">      </div>
<div class="line">      openGL.glDisable(OpenGL::COLOR_MATERIAL);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> makeCone() noexcept {</div>
<div class="line">      OpenGL::DisplayList displayList(openGL, OBJECT_CONE);</div>
<div class="line">      openGL.glColorMaterial(OpenGL::FRONT, OpenGL::EMISSION);</div>
<div class="line">      openGL.glEnable(OpenGL::COLOR_MATERIAL);</div>
<div class="line">      openGL.glColor4f(0.25, 0.5, 0.75, 0.5);</div>
<div class="line">      openGL.cone(6.0, 12.0, 8, 8);</div>
<div class="line">      openGL.glDisable(OpenGL::COLOR_MATERIAL);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> makeTorus() noexcept {</div>
<div class="line">      OpenGL::DisplayList displayList(openGL, OBJECT_TORUS);</div>
<div class="line">      openGL.glColorMaterial(OpenGL::FRONT, OpenGL::EMISSION);</div>
<div class="line">      openGL.glEnable(OpenGL::COLOR_MATERIAL);</div>
<div class="line">      openGL.glColor4f(0.25, 0.5, 0.75, 0.5);</div>
<div class="line">      openGL.torus(4.0, 8.0, 64, 16);</div>
<div class="line">      openGL.glDisable(OpenGL::COLOR_MATERIAL);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> displayBlackness() noexcept {</div>
<div class="line">      openGL.glClearColor(0.0, 0.0, 0.0, 1.0);</div>
<div class="line">      openGL.glClear(OpenGL::COLOR_BUFFER_BIT);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> displayObject(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keywordtype">object</span>) noexcept {</div>
<div class="line">      openGL.glClearColor(0.0, 0.0, 0.0, 1.0);</div>
<div class="line">      openGL.glClear(OpenGL::COLOR_BUFFER_BIT | OpenGL::DEPTH_BUFFER_BIT);</div>
<div class="line">      </div>
<div class="line">      openGL.glMatrixMode(OpenGL::MODELVIEW);</div>
<div class="line">      openGL.glLoadIdentity();</div>
<div class="line">      Vector3D&lt;long double&gt; translation = view.getTranslation();</div>
<div class="line">      openGL.glTranslatef(translation.getX(), translation.getY(), translation.getZ());</div>
<div class="line">      Vector3D&lt;long double&gt; rotation = view.getRotation();</div>
<div class="line">      openGL.glRotatef(rotation.getX(), 0.0, 1.0, 0.0);</div>
<div class="line">      openGL.glRotatef(rotation.getY(), 1.0, 0.0, 0.0);</div>
<div class="line">      openGL.glRotatef(rotation.getZ(), 0.0, 0.0, 1.0);</div>
<div class="line">      openGL.glScalef(view.getScale() * 0.05, view.getScale() * 0.05, view.getScale() * 0.05);</div>
<div class="line"> </div>
<div class="line">      openGL.glCallList(<span class="keywordtype">object</span>);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> setRenderable(Renderable* renderable) noexcept {</div>
<div class="line">      <span class="keywordflow">if</span> (this-&gt;renderable) {</div>
<div class="line">        <span class="keyword">delete</span> this-&gt;renderable;</div>
<div class="line">      }</div>
<div class="line">      this-&gt;renderable = renderable;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> onDisplay() noexcept {</div>
<div class="line">      <span class="keywordflow">if</span> (renderable) {</div>
<div class="line">        renderable-&gt;update(view);</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">switch</span> (mode) {</div>
<div class="line">        <span class="keywordflow">case</span> MODE_BLACKNESS:</div>
<div class="line">          displayBlackness();</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> MODE_SYSTEM:</div>
<div class="line">          displayObject(OBJECT_SYSTEM);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> MODE_FLOOR:</div>
<div class="line">          displayObject(OBJECT_FLOOR);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> MODE_CUBE:</div>
<div class="line">          displayObject(OBJECT_CUBE);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> MODE_CONE:</div>
<div class="line">          displayObject(OBJECT_CONE);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> MODE_TORUS:</div>
<div class="line">          displayObject(OBJECT_TORUS);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">      openGL.glFlush();</div>
<div class="line">      swap();</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> onMove(<span class="keyword">const</span> Position&amp; position) noexcept {</div>
<div class="line">      <span class="keywordflow">if</span> (verbosity &gt;= Verbosity::ALL_MOUSE_EVENTS) {</div>
<div class="line">        fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Window move event: &quot;</span>) &lt;&lt; position &lt;&lt; ENDL;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> onResize(<span class="keyword">const</span> Dimension&amp; dimension) noexcept {</div>
<div class="line">      <span class="keywordflow">if</span> (verbosity &gt;= Verbosity::ALL_MOUSE_EVENTS) {</div>
<div class="line">        fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Resize event: &quot;</span>) &lt;&lt; dimension &lt;&lt; ENDL;</div>
<div class="line">      }</div>
<div class="line">      </div>
<div class="line">      openGL.glViewport(0, 0, dimension.getWidth(), dimension.getHeight());</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// TAG: fixme</span></div>
<div class="line">      <span class="comment">// openGL.glMatrixMode(OpenGL::MODELVIEW);</span></div>
<div class="line">      openGL.glMatrixMode(OpenGL::PROJECTION);</div>
<div class="line">      openGL.glLoadIdentity();</div>
<div class="line">      <span class="keywordtype">double</span> aspectRatio = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(dimension.getWidth())/</div>
<div class="line">        <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(dimension.getHeight());</div>
<div class="line">      openGL.perspective(0 * 45.0, aspectRatio, 0.01, 100.0);</div>
<div class="line">      </div>
<div class="line">      <span class="comment">// openGL.glMatrixMode(OpenGL::PROJECTION); // TAG: fixme</span></div>
<div class="line">      <span class="comment">// openGL.glLoadIdentity();</span></div>
<div class="line">      <span class="comment">// orthoTop = 1.0;</span></div>
<div class="line">      <span class="comment">// orthoBottom = -1.0;</span></div>
<div class="line">      <span class="comment">// orthoRight = static_cast&lt;double&gt;(dimension.getWidth())/static_cast&lt;double&gt;(dimension.getHeight());</span></div>
<div class="line">      <span class="comment">// orthoLeft = -orthoRight;</span></div>
<div class="line">      <span class="comment">// openGL.glOrtho(orthoLeft, orthoRight, orthoBottom, orthoTop, orthoNear, orthoFar);</span></div>
<div class="line">      </div>
<div class="line">      invalidate();</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">struct </span>Flag {</div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mask;</div>
<div class="line">      Literal literal;</div>
<div class="line">    };</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> onMouseMove(<span class="keyword">const</span> Position&amp; position, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> state) noexcept {</div>
<div class="line">      <span class="keyword">const</span> Position difference = position - mouseButtonPosition;</div>
<div class="line">      <span class="keywordflow">if</span> (verbosity &gt;= Verbosity::ALL_MOUSE_EVENTS) {</div>
<div class="line">        fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Mouse motion event: &quot;</span>) &lt;&lt; position &lt;&lt; ENDL;</div>
<div class="line">      }</div>
<div class="line">      setCursor(OpenGLContext::HAND); <span class="comment">// TAG: remove</span></div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> ((mouseMiddleButtonPressed) || (mouseLeftButtonPressed &amp;&amp; mouseRightButtonPressed)) {</div>
<div class="line">        <span class="keywordflow">if</span> (state &amp; Key::CONTROL) {</div>
<div class="line">          <span class="keywordtype">int</span> viewPort[4];</div>
<div class="line">          openGL.glGetIntegerv(OpenGL::VIEWPORT, viewPort);</div>
<div class="line">          Vector3D&lt;long double&gt; position3D = mapXYToWorld(position, viewPort);</div>
<div class="line">          view.translation.setX(translationBegin.getX() + position3D.getX() - drag.getX());</div>
<div class="line">          view.translation.setY(translationBegin.getY() + position3D.getY() - drag.getY());</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">          <span class="keywordtype">long</span> <span class="keywordtype">double</span> scale = scaleBegin * Math::exp(<span class="keyword">static_cast&lt;</span><span class="keywordtype">long</span> <span class="keywordtype">double</span><span class="keyword">&gt;</span>(difference.getY() * 0.01));</div>
<div class="line">          <span class="keywordflow">if</span> (scale &lt; 0.00001) {</div>
<div class="line">            scale = 0.0001;</div>
<div class="line">          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (scale &gt;= 10.0) {</div>
<div class="line">            scale = 10.0;</div>
<div class="line">          }</div>
<div class="line">          view.setScale(scale);</div>
<div class="line">        }</div>
<div class="line">        invalidate();</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mouseLeftButtonPressed) {</div>
<div class="line">        <span class="comment">// TAG: fixme</span></div>
<div class="line">        <span class="keywordflow">if</span> (state &amp; Key::CONTROL) {</div>
<div class="line">          view.rotation.setZ(</div>
<div class="line">            rotationBegin.getZ() + difference.getX()/(256<span class="comment">/*dimension.getWidth()*/</span>/180.0)</div>
<div class="line">          );</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">          view.rotation.setX(</div>
<div class="line">            rotationBegin.getX() + difference.getX()/(256<span class="comment">/*dimension.getHeight()*/</span>/180.0)</div>
<div class="line">          );</div>
<div class="line">          view.rotation.setY(</div>
<div class="line">            rotationBegin.getY() + difference.getY()/(256<span class="comment">/*dimension.getWidth()*/</span>/180.0)</div>
<div class="line">          );</div>
<div class="line">          </div>
<div class="line">          <span class="comment">/*long double ax = difference.getY();</span></div>
<div class="line"><span class="comment">            long double ay = difference.getX();</span></div>
<div class="line"><span class="comment">            long double az = 0;</span></div>
<div class="line"><span class="comment">            long double angle = 180.0 * Math::sqrt(ax*ax + ay*ay + az*az)/static_cast&lt;long double&gt;(dimension.getWidth());</span></div>
<div class="line"><span class="comment">          */</span></div>
<div class="line">          <span class="comment">// use inverse matrix to determine local axis of rotation</span></div>
<div class="line">          <span class="comment">//openGL.glGetDoublev(OpenGL::MODELVIEW_MATRIX, modelViewMatrix);</span></div>
<div class="line">          <span class="comment">//invertMatrix(modelViewMatrix, invertedModelViewMatrix);</span></div>
<div class="line">            </div>
<div class="line">          <span class="comment">//long double axisX = invertedModelViewMatrix[0] * ax + invertedModelViewMatrix[4] * ay + invertedModelViewMatrix[7] * az;</span></div>
<div class="line">          <span class="comment">//long double axisY = invertedModelViewMatrix[1] * ax + invertedModelViewMatrix[5] * ay + invertedModelViewMatrix[8] * az;</span></div>
<div class="line">          <span class="comment">//long double axisZ = invertedModelViewMatrix[2] * ax + invertedModelViewMatrix[6] * ay + invertedModelViewMatrix[9] * az;</span></div>
<div class="line">          <span class="comment">//openGL.glRotatef(angle, axisX, axisY, axisZ);</span></div>
<div class="line">        }</div>
<div class="line">        invalidate();</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">//         if (buttons != 0) {</span></div>
<div class="line">      <span class="comment">//           fout &lt;&lt; MESSAGE(&quot;Mouse move: &quot;) &lt;&lt; position &lt;&lt; &#39; &#39; &lt;&lt; MESSAGE(&quot;ACTIVE&quot;) &lt;&lt; ENDL;</span></div>
<div class="line">      <span class="comment">//         } else {</span></div>
<div class="line">      <span class="comment">//           fout &lt;&lt; MESSAGE(&quot;Mouse move: &quot;) &lt;&lt; position &lt;&lt; &#39; &#39; &lt;&lt; MESSAGE(&quot;PASSIVE&quot;) &lt;&lt; ENDL;</span></div>
<div class="line">      <span class="comment">//         }</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> onMouseScope(<span class="keywordtype">bool</span> scope) noexcept {</div>
<div class="line">      fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Event: mouse scope &quot;</span>)</div>
<div class="line">           &lt;&lt; (scope ? MESSAGE(<span class="stringliteral">&quot;INSIDE SCOPE&quot;</span>) : MESSAGE(<span class="stringliteral">&quot;OUT OF SCOPE&quot;</span>)) &lt;&lt; ENDL;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> onMouseButton(<span class="keyword">const</span> Position&amp; position, Mouse::Button button, Mouse::Event event, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> state) noexcept {</div>
<div class="line">      <span class="keyword">static</span> <span class="keyword">const</span> Flag STATES[] = {</div>
<div class="line">        {Mouse::LEFT, MESSAGE(<span class="stringliteral">&quot;LEFT&quot;</span>)},</div>
<div class="line">        {Mouse::MIDDLE, MESSAGE(<span class="stringliteral">&quot;MIDDLE&quot;</span>)},</div>
<div class="line">        {Mouse::RIGHT, MESSAGE(<span class="stringliteral">&quot;RIGHT&quot;</span>)},</div>
<div class="line">        {Mouse::WHEEL, MESSAGE(<span class="stringliteral">&quot;WHEEL&quot;</span>)},</div>
<div class="line">        {Mouse::EXTRA, MESSAGE(<span class="stringliteral">&quot;EXTRA&quot;</span>)},</div>
<div class="line">        {Mouse::EXTRA2, MESSAGE(<span class="stringliteral">&quot;EXTRA2&quot;</span>)},</div>
<div class="line">        {Key::LEFT_CONTROL, MESSAGE(<span class="stringliteral">&quot;L-CTRL&quot;</span>)},</div>
<div class="line">        {Key::RIGHT_CONTROL, MESSAGE(<span class="stringliteral">&quot;R-CTRL&quot;</span>)},</div>
<div class="line">        {Key::LEFT_SHIFT, MESSAGE(<span class="stringliteral">&quot;L-SHFT&quot;</span>)},</div>
<div class="line">        {Key::RIGHT_SHIFT, MESSAGE(<span class="stringliteral">&quot;R-SHFT&quot;</span>)},</div>
<div class="line">        {Key::LEFT_ALT, MESSAGE(<span class="stringliteral">&quot;L-ALT&quot;</span>)},</div>
<div class="line">        {Key::RIGHT_ALT, MESSAGE(<span class="stringliteral">&quot;R-ALT&quot;</span>)},</div>
<div class="line">        {Key::NUM_LOCK_TOGGLED, MESSAGE(<span class="stringliteral">&quot;NUM&quot;</span>)},</div>
<div class="line">        {Key::CAPS_LOCK_TOGGLED, MESSAGE(<span class="stringliteral">&quot;CAPS&quot;</span>)},</div>
<div class="line">        {Key::SCROLL_LOCK_TOGGLED, MESSAGE(<span class="stringliteral">&quot;SCROLL&quot;</span>)},</div>
<div class="line">        {Key::INSERT_TOGGLED, MESSAGE(<span class="stringliteral">&quot;INSERT&quot;</span>)}</div>
<div class="line">      };</div>
<div class="line">      </div>
<div class="line">      <span class="keyword">static</span> <span class="keyword">const</span> Literal EVENT_STRING[] = {</div>
<div class="line">        MESSAGE(<span class="stringliteral">&quot;PRESSED&quot;</span>),</div>
<div class="line">        MESSAGE(<span class="stringliteral">&quot;RELEASED&quot;</span>),</div>
<div class="line">        MESSAGE(<span class="stringliteral">&quot;DOUBLE CLICKED&quot;</span>),</div>
<div class="line">        MESSAGE(<span class="stringliteral">&quot;TURNED&quot;</span>)</div>
<div class="line">      };</div>
<div class="line">      </div>
<div class="line">      <span class="keywordflow">if</span> (verbosity &gt;= Verbosity::ACTIVE_MOUSE_EVENTS) {</div>
<div class="line">        fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Mouse button event: &quot;</span>)</div>
<div class="line">             &lt;&lt; getMouseButtonName(button) &lt;&lt; <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(event) &lt; getArraySize(EVENT_STRING)) {</div>
<div class="line">          fout &lt;&lt; EVENT_STRING[event];</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">          fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;[UNNAMED EVENT]&quot;</span>) &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(event);</div>
<div class="line">        }</div>
<div class="line">        fout &lt;&lt; <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; getArraySize(STATES); ++i) {</div>
<div class="line">          <span class="keywordflow">if</span> (state &amp; STATES[i].mask) {</div>
<div class="line">            fout &lt;&lt; STATES[i].literal &lt;&lt; <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        fout &lt;&lt; position &lt;&lt; ENDL;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">switch</span> (button) {</div>
<div class="line">      <span class="keywordflow">case</span> Mouse::LEFT:</div>
<div class="line">        mouseLeftButtonPressed = <span class="keyword">event</span> == Mouse::PRESSED;</div>
<div class="line">        setCapture(mouseLeftButtonPressed);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Mouse::MIDDLE:</div>
<div class="line">        mouseMiddleButtonPressed = <span class="keyword">event</span> == Mouse::PRESSED;</div>
<div class="line">        setCapture(mouseMiddleButtonPressed);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Mouse::RIGHT:        </div>
<div class="line">        mouseRightButtonPressed = <span class="keyword">event</span> == Mouse::PRESSED;</div>
<div class="line">        setCapture(<span class="keyword">false</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (event == Mouse::PRESSED) {</div>
<div class="line">          displayMenu(position, menu);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      mouseButtonPosition = position;</div>
<div class="line">      </div>
<div class="line">      <span class="keywordflow">if</span> (event == Mouse::PRESSED) {</div>
<div class="line">        <span class="comment">// command: TRANSLATE_IN_XY_PLANE</span></div>
<div class="line">        <span class="comment">// command: ROTATE_AROUND_X_AND_Y</span></div>
<div class="line">        <span class="comment">// command: SCALE</span></div>
<div class="line">        <span class="comment">// command: MEASURE_DISTANCE</span></div>
<div class="line">        translationBegin = view.getTranslation();</div>
<div class="line">        rotationBegin = view.getRotation();</div>
<div class="line">        scaleBegin = view.getScale();</div>
<div class="line">      }</div>
<div class="line">      </div>
<div class="line">      <span class="keywordtype">int</span> viewPort[4];</div>
<div class="line">      openGL.glGetIntegerv(OpenGL::VIEWPORT, viewPort);</div>
<div class="line">      Vector3D&lt;long double&gt; drag = mapXYToWorld(position, viewPort);    </div>
<div class="line">      drag.setZ(0);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> onMouseWheel(<span class="keyword">const</span> Position&amp; position, <span class="keywordtype">int</span> delta, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> buttons) noexcept {</div>
<div class="line">      <span class="keywordflow">if</span> (verbosity &gt;= Verbosity::ACTIVE_MOUSE_EVENTS) {</div>
<div class="line">        fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Mouse wheel&quot;</span>) &lt;&lt; ENDL;</div>
<div class="line">      }</div>
<div class="line">      setTranslation(view.getTranslation() + Vector3D&lt;long double&gt;(0, 0, 0.1 * delta/120));</div>
<div class="line">      invalidate();</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> onKey(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flags, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> modifiers) noexcept {</div>
<div class="line">      <span class="keywordflow">if</span> (flags &amp; Key::PRESSED) {</div>
<div class="line">        <span class="keywordflow">if</span> (flags &amp; Key::DEAD) {</div>
<div class="line">          <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((flags &amp; Key::ASCII) &amp;&amp; ASCIITraits::isGraph(key)) {</div>
<div class="line">          fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Key: &quot;</span>) &lt;&lt; PREFIX &lt;&lt; HEX &lt;&lt; key &lt;&lt; <span class="charliteral">&#39; &#39;</span></div>
<div class="line">               &lt;&lt; <span class="charliteral">&#39;\&#39;&#39;</span> &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span><span class="keyword">&gt;</span>(key) &lt;&lt; <span class="charliteral">&#39;\&#39;&#39;</span></div>
<div class="line">               &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; MESSAGE(<span class="stringliteral">&quot;PRESSED&quot;</span>);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">          fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Key: &quot;</span>) &lt;&lt; PREFIX &lt;&lt; HEX &lt;&lt; key &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; MESSAGE(<span class="stringliteral">&quot;PRESSED&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (flags &amp; Key::FIRST_TIME) {</div>
<div class="line">          fout &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; MESSAGE(<span class="stringliteral">&quot;FIRST&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        fout &lt;&lt; ENDL;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Key: &quot;</span>) &lt;&lt; PREFIX &lt;&lt; HEX &lt;&lt; key &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; MESSAGE(<span class="stringliteral">&quot;RELEASED&quot;</span>) &lt;&lt; ENDL;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (flags &amp; Key::PRESSED) {</div>
<div class="line">        <span class="keywordflow">if</span> (flags &amp; Key::DEAD) {</div>
<div class="line">          <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">          </div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> command = Command::NOTHING;</div>
<div class="line">        <span class="keywordflow">switch</span> (key) {</div>
<div class="line">        <span class="keywordflow">case</span> Key::LEFT:</div>
<div class="line">          command = Command::ROTATE_AROUND_X_AXIS_NEG;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> Key::RIGHT:</div>
<div class="line">          command = Command::ROTATE_AROUND_X_AXIS_POS;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> Key::UP:</div>
<div class="line">          command = Command::ROTATE_AROUND_Y_AXIS_NEG;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> Key::DOWN:</div>
<div class="line">          command = Command::ROTATE_AROUND_Y_AXIS_POS;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> Key::PRIOR:</div>
<div class="line">          <span class="keywordflow">if</span> (modifiers &amp; Key::SHIFT) {</div>
<div class="line">            command = Command::TRANSLATE_ALONG_X_NEG;</div>
<div class="line">          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (modifiers &amp; Key::CONTROL) {</div>
<div class="line">            command = Command::TRANSLATE_ALONG_Y_NEG;</div>
<div class="line">          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (modifiers &amp; Key::ALT) {</div>
<div class="line">          } <span class="keywordflow">else</span> {</div>
<div class="line">            command = Command::TRANSLATE_ALONG_Z_NEG;</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> Key::NEXT:</div>
<div class="line">          <span class="keywordflow">if</span> (modifiers &amp; Key::SHIFT) {</div>
<div class="line">            command = Command::TRANSLATE_ALONG_X_POS;</div>
<div class="line">          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (modifiers &amp; Key::CONTROL) {</div>
<div class="line">            command = Command::TRANSLATE_ALONG_Y_POS;</div>
<div class="line">          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (modifiers &amp; Key::ALT) {</div>
<div class="line">          } <span class="keywordflow">else</span> {</div>
<div class="line">            command = Command::TRANSLATE_ALONG_Z_POS;</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> Key::HOME:</div>
<div class="line">          command = Command::RESET_VIEW_PARAMETERS;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> Key::END:</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> Key::F1:</div>
<div class="line">          command = Command::SHOW_OPENGL_INFORMATION;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> Key::F12:</div>
<div class="line">          command = Command::CYCLE_DISPLAY_MODE;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39; &#39;</span>:</div>
<div class="line">          command = Command::RENDER_DEFAULT;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>:</div>
<div class="line">          command = Command::QUIT;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>:</div>
<div class="line">          setAutorepeat(!getAutorepeat());</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div>
<div class="line">          command = Command::CYCLE_SHADING_MODEL;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:</div>
<div class="line">          command = blending ? Command::BLENDING_DISABLE : Command::BLENDING_ENABLE;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>:</div>
<div class="line">          command = Command::SELECT_SHADING_MODEL_FLAT;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;L&#39;</span>:</div>
<div class="line">          command = lighting ? Command::LIGHTING_DISABLE : Command::LIGHTING_ENABLE;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:</div>
<div class="line">          command = Command::SELECT_POLYGON_MODE_FILL;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>:</div>
<div class="line">          command = Command::SELECT_POLYGON_MODE_LINE;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:</div>
<div class="line">          command = Command::SELECT_POLYGON_MODE_POINT;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>:</div>
<div class="line">          command = Command::RESET_VIEW_PARAMETERS;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        onCommand(command);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> onIdle() noexcept {</div>
<div class="line">      invalidate();</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">bool</span> onClose() noexcept {</div>
<div class="line">      fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Event: close &quot;</span>) &lt;&lt; ENDL;</div>
<div class="line">      MessageDialog dialog(</div>
<div class="line">        MESSAGE(<span class="stringliteral">&quot;Quit&quot;</span>),</div>
<div class="line">        MESSAGE(<span class="stringliteral">&quot;Do you really wan&#39;t to quit?&quot;</span>),</div>
<div class="line">        MessageDialog::QUESTION</div>
<div class="line">      );</div>
<div class="line">      dialog.execute();</div>
<div class="line">      <span class="keywordflow">if</span> (dialog.getAnswer() == MessageDialog::YES) {</div>
<div class="line">        Application::getApplication()-&gt;terminate();</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">return</span> dialog.getAnswer() == MessageDialog::YES;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> onVisibility(Visibility visibility) noexcept {</div>
<div class="line">      <span class="keywordflow">if</span> (verbosity &gt;= Verbosity::ACTIVE_MOUSE_EVENTS) {</div>
<div class="line">        fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Visibility event: &quot;</span>)</div>
<div class="line">             &lt;&lt; ((visibility == VISIBLE) ? MESSAGE(<span class="stringliteral">&quot;VISIBLE&quot;</span>) : MESSAGE(<span class="stringliteral">&quot;INVISIBLE&quot;</span>))</div>
<div class="line">             &lt;&lt; ENDL;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> onFocus(Focus focus) noexcept {</div>
<div class="line">      <span class="keywordflow">if</span> (verbosity &gt;= Verbosity::ACTIVE_MOUSE_EVENTS) {</div>
<div class="line">        fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Focus event: &quot;</span>)</div>
<div class="line">             &lt;&lt; ((focus == ACQUIRED_FOCUS) ? MESSAGE(<span class="stringliteral">&quot;ACQUIRED FOCUS&quot;</span>) : MESSAGE(<span class="stringliteral">&quot;LOST FOCUS&quot;</span>))</div>
<div class="line">             &lt;&lt; ENDL;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> dumpOpenGLInformation() noexcept {</div>
<div class="line">      fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;OpenGL context information: &quot;</span>) &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;client vendor: &quot;</span>) &lt;&lt; getGLClientVendor() &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;client release: &quot;</span>) &lt;&lt; getGLClientRelease() &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;client extensions: &quot;</span>) &lt;&lt; getGLClientExtensions() &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;server vendor: &quot;</span>) &lt;&lt; getGLServerVendor() &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;server release: &quot;</span>) &lt;&lt; getGLServerRelease() &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;server extensions: &quot;</span>) &lt;&lt; getGLServerExtensions() &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;direct context: &quot;</span>) &lt;&lt; isDirect() &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; ENDL;</div>
<div class="line">      fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Vendor: &quot;</span>) &lt;&lt; openGL.getVendor() &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Renderer: &quot;</span>) &lt;&lt; openGL.getRenderer() &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Version: &quot;</span>) &lt;&lt; openGL.getVersion() &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Extensions: &quot;</span>) &lt;&lt; openGL.getExtensions() &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Rendering context:&quot;</span>) &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;red bits: &quot;</span>) &lt;&lt; redBits &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;green bits: &quot;</span>) &lt;&lt; greenBits &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;blue bits: &quot;</span>) &lt;&lt; blueBits &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;alpha bits: &quot;</span>) &lt;&lt; alphaBits &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;accumulator red bits: &quot;</span>) &lt;&lt; accumulatorRedBits &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;accumulator green bits: &quot;</span>) &lt;&lt; accumulatorGreenBits &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;accumulator blue bits: &quot;</span>) &lt;&lt; accumulatorBlueBits &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;accumulator alpha bits: &quot;</span>) &lt;&lt; accumulatorAlphaBits &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;depth bits: &quot;</span>) &lt;&lt; depthBits &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;stencil bits: &quot;</span>) &lt;&lt; stencilBits &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;aux buffers: &quot;</span>) &lt;&lt; auxBuffers &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;overlay planes: &quot;</span>) &lt;&lt; numberOfOverlayPlanes &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;underlay planes: &quot;</span>) &lt;&lt; numberOfUnderlayPlanes &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;double buffered: &quot;</span>) &lt;&lt; isDoubleBuffered() &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;stereoscopic: &quot;</span>) &lt;&lt; isStereoscopic() &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;direct: &quot;</span>) &lt;&lt; isDirect() &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;generic: &quot;</span>) &lt;&lt; isGeneric() &lt;&lt; EOL</div>
<div class="line">           &lt;&lt; ENDL;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> openImage() noexcept {</div>
<div class="line">      <span class="keywordflow">try</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (!openFile.execute()) {</div>
<div class="line">          <span class="keywordflow">return</span>; <span class="comment">// canceled</span></div>
<div class="line">        }</div>
<div class="line">      } <span class="keywordflow">catch</span> (UserInterfaceException&amp;) {</div>
<div class="line">        MessageDialog dialog(</div>
<div class="line">          MESSAGE(<span class="stringliteral">&quot;Error&quot;</span>),</div>
<div class="line">          MESSAGE(<span class="stringliteral">&quot;Unable to open dialog.&quot;</span>),</div>
<div class="line">          MessageDialog::ERROR</div>
<div class="line">        );</div>
<div class="line">        dialog.execute();</div>
<div class="line">      }</div>
<div class="line">      ImageEncoder* encoder = encoderRegistry.getEncoder(openFile.getFilename());</div>
<div class="line">      <span class="keywordflow">if</span> (!encoder) {</div>
<div class="line">        MessageDialog dialog(</div>
<div class="line">          MESSAGE(<span class="stringliteral">&quot;Error&quot;</span>),</div>
<div class="line">          MESSAGE(<span class="stringliteral">&quot;Unable to resolve image encoder.&quot;</span>),</div>
<div class="line">          MessageDialog::ERROR</div>
<div class="line">        );</div>
<div class="line">        dialog.execute();</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">if</span> (verbosity &gt;= Verbosity::EVERYTHING) {</div>
<div class="line">        fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Encoder: &quot;</span>) &lt;&lt; encoder-&gt;getDescription() &lt;&lt; ENDL;</div>
<div class="line">      }</div>
<div class="line">      ColorImage* frame = <span class="keyword">nullptr</span>;</div>
<div class="line">      <span class="keywordflow">try</span> {</div>
<div class="line">        frame = encoder-&gt;read(openFile.getFilename());</div>
<div class="line">      } <span class="keywordflow">catch</span> (IOException) {</div>
<div class="line">        MessageDialog dialog(</div>
<div class="line">          MESSAGE(<span class="stringliteral">&quot;Error&quot;</span>),</div>
<div class="line">          MESSAGE(<span class="stringliteral">&quot;Unable to open image.&quot;</span>),</div>
<div class="line">          MessageDialog::ERROR</div>
<div class="line">        );</div>
<div class="line">        dialog.execute();</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line">      image = *frame;</div>
<div class="line">      <span class="keyword">delete</span> frame;</div>
<div class="line">    }</div>
<div class="line">      </div>
<div class="line">    <span class="keywordtype">void</span> saveFrameBuffer() noexcept {</div>
<div class="line">      <span class="keywordflow">try</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (!saveFile.execute()) {</div>
<div class="line">          <span class="keywordflow">return</span>; <span class="comment">// canceled</span></div>
<div class="line">        }</div>
<div class="line">      } <span class="keywordflow">catch</span> (UserInterfaceException&amp;) {</div>
<div class="line">        MessageDialog dialog(</div>
<div class="line">          MESSAGE(<span class="stringliteral">&quot;Error&quot;</span>),</div>
<div class="line">          MESSAGE(<span class="stringliteral">&quot;Unable to open dialog.&quot;</span>),</div>
<div class="line">          MessageDialog::ERROR</div>
<div class="line">        );</div>
<div class="line">        dialog.execute();</div>
<div class="line">      }</div>
<div class="line">      ImageEncoder* encoder = encoderRegistry.getEncoder(saveFile.getFilename());</div>
<div class="line">      <span class="keywordflow">if</span> (!encoder) {</div>
<div class="line">        MessageDialog dialog(</div>
<div class="line">          MESSAGE(<span class="stringliteral">&quot;Error&quot;</span>),</div>
<div class="line">          MESSAGE(<span class="stringliteral">&quot;Unable to resolve image encoder.&quot;</span>),</div>
<div class="line">          MessageDialog::ERROR</div>
<div class="line">        );</div>
<div class="line">        dialog.execute();</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">if</span> (verbosity &gt;= Verbosity::EVERYTHING) {</div>
<div class="line">        fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Encoder: &quot;</span>) &lt;&lt; encoder-&gt;getDescription() &lt;&lt; ENDL;</div>
<div class="line">      }</div>
<div class="line">      OpenGL::GLint viewPort[4];</div>
<div class="line">      openGL.glGetIntegerv(OpenGL::VIEWPORT, viewPort);</div>
<div class="line">      <span class="comment">// ColorImage frame(Dimension(viewPort[2], viewPort[3])); // TAG: fixme</span></div>
<div class="line">      ColorImage* frame = <span class="keyword">new</span> ColorImage(Dimension(viewPort[2], viewPort[3]));</div>
<div class="line">      openGL.glPixelStorei(OpenGL::PACK_ALIGNMENT, 4);</div>
<div class="line">      <span class="comment">// TAG: need atomic access to frame</span></div>
<div class="line">      openGL.glReadPixels(</div>
<div class="line">        0,</div>
<div class="line">        0,</div>
<div class="line">        viewPort[2],</div>
<div class="line">        viewPort[3],</div>
<div class="line">        OpenGL::RGBA,</div>
<div class="line">        OpenGL::UNSIGNED_BYTE,</div>
<div class="line">        frame-&gt;getElements()</div>
<div class="line">      );</div>
<div class="line">      <span class="keywordflow">try</span> {</div>
<div class="line">        encoder-&gt;write(saveFile.getFilename(), frame);</div>
<div class="line">      } <span class="keywordflow">catch</span> (IOException) {</div>
<div class="line">        MessageDialog dialog(MESSAGE(<span class="stringliteral">&quot;Error&quot;</span>), MESSAGE(<span class="stringliteral">&quot;Unable to save image.&quot;</span>), MessageDialog::ERROR);</div>
<div class="line">        dialog.execute();</div>
<div class="line">      }</div>
<div class="line">      <span class="keyword">delete</span> frame;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> setDisplayMode(DisplayMode displayMode) noexcept {</div>
<div class="line">      <span class="keywordflow">if</span> (displayMode != this-&gt;displayMode) {</div>
<div class="line">        <span class="keywordflow">try</span> {</div>
<div class="line">          <span class="comment">// TAG: fixme</span></div>
<div class="line">          this-&gt;displayMode = displayMode;</div>
<div class="line">        } <span class="keywordflow">catch</span> (UserInterfaceException&amp;) {</div>
<div class="line">          MessageDialog dialog(</div>
<div class="line">            MESSAGE(<span class="stringliteral">&quot;Error&quot;</span>),</div>
<div class="line">            MESSAGE(<span class="stringliteral">&quot;Unable to switch display mode.&quot;</span>),</div>
<div class="line">            MessageDialog::ERROR</div>
<div class="line">          );</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> dumpCommand(<span class="keyword">const</span> Literal&amp; description) noexcept {</div>
<div class="line">      <span class="keywordflow">if</span> (verbosity &gt;= Verbosity::COMMANDS) {</div>
<div class="line">        fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Command: &quot;</span>) &lt;&lt; description &lt;&lt; ENDL;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">     </div>
<div class="line">    <span class="keywordtype">void</span> onCommand(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> identifier) noexcept {</div>
<div class="line">      <span class="keywordflow">switch</span> (identifier) {</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_VERBOSITY_NO_INFORMATION:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Set verbosity level to NO_INFORMATION&quot;</span>));</div>
<div class="line">        setVerbosity(Verbosity::NO_INFORMATION);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_VERBOSITY_WARNINGS:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Set verbosity level to WARNINGS&quot;</span>));</div>
<div class="line">        setVerbosity(Verbosity::WARNINGS);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_VERBOSITY_NORMAL:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Set verbosity level to NORMAL&quot;</span>));</div>
<div class="line">        setVerbosity(Verbosity::NORMAL);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_VERBOSITY_COMMANDS:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Set verbosity level to COMMANDS&quot;</span>));</div>
<div class="line">        setVerbosity(Verbosity::COMMANDS);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_VERBOSITY_ACTIVE_MOUSE_EVENTS:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Set verbosity level to ACTIVE_MOUSE_EVENTS&quot;</span>));</div>
<div class="line">        setVerbosity(Verbosity::ACTIVE_MOUSE_EVENTS);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_VERBOSITY_ALL_MOUSE_EVENTS:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Set verbosity level to ALL_MOUSE_EVENTS&quot;</span>));</div>
<div class="line">        setVerbosity(Verbosity::ALL_MOUSE_EVENTS);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_VERBOSITY_EVERYTHING:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Set verbosity level to EVERYTHING&quot;</span>));</div>
<div class="line">        setVerbosity(Verbosity::EVERYTHING);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::OPEN_IMAGE:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Open image&quot;</span>));</div>
<div class="line">        openImage();</div>
<div class="line">        <span class="keywordflow">if</span> ((mode != MODE_INTENSITY) &amp;&amp; (mode != MODE_RGB_CLOUD)) {</div>
<div class="line">          setMode(MODE_INTENSITY); <span class="comment">// TAG: use last image mode</span></div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">          setMode(mode);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SAVE_IMAGE:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Save image&quot;</span>));</div>
<div class="line">        saveFrameBuffer();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::HELP:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Help&quot;</span>));</div>
<div class="line">        fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Help&quot;</span>) &lt;&lt; EOL &lt;&lt; ENDL; <span class="comment">// TAG: fixme</span></div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SHOW_OPENGL_INFORMATION:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Show OpenGL information&quot;</span>));</div>
<div class="line">        dumpOpenGLInformation();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::ABOUT:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;About&quot;</span>));</div>
<div class="line">        fout &lt;&lt; base::Version().getBanner() &lt;&lt; EOL &lt;&lt; ENDL;</div>
<div class="line">        fout &lt;&lt; <a name="_a0"></a><a class="code" href="classgip_1_1_version.html">gip::Version</a>().<a name="a1"></a><a class="code" href="classgip_1_1_version.html#a8695d6c7b3a6ea08300fd903b63b1cdd">getBanner</a>() &lt;&lt; EOL &lt;&lt; ENDL;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::CYCLE_DISPLAY_MODE:</div>
<div class="line">        {</div>
<div class="line">          dumpCommand(MESSAGE(<span class="stringliteral">&quot;Cycle display mode&quot;</span>));</div>
<div class="line">          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> displayMode = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(this-&gt;displayMode) + 1;</div>
<div class="line">          <span class="keywordflow">if</span> (displayMode &gt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(DISPLAY_MODE_LAST)) {</div>
<div class="line">            displayMode = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(DISPLAY_MODE_FIRST);</div>
<div class="line">          }</div>
<div class="line">          setDisplayMode(<span class="keyword">static_cast&lt;</span>DisplayMode<span class="keyword">&gt;</span>(displayMode));</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::QUIT:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Quit&quot;</span>));</div>
<div class="line">        <span class="keywordflow">if</span> (onClose()) {</div>
<div class="line">          exit();</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::CYCLE_SHADING_MODEL:</div>
<div class="line">        {</div>
<div class="line">          dumpCommand(MESSAGE(<span class="stringliteral">&quot;Cycle shading model&quot;</span>));</div>
<div class="line">          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> shadingModel = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(this-&gt;shadingModel) + 1;</div>
<div class="line">          <span class="keywordflow">if</span> (shadingModel &gt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(ShadingModel::LAST_MODEL)) {</div>
<div class="line">            shadingModel = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(ShadingModel::FIRST_MODEL);</div>
<div class="line">          }</div>
<div class="line">          setShadingModel(<span class="keyword">static_cast&lt;</span>ShadingModel::Model<span class="keyword">&gt;</span>(shadingModel));</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_SHADING_MODEL_FLAT:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Select shading model: flat&quot;</span>));</div>
<div class="line">        setShadingModel(ShadingModel::FLAT);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_SHADING_MODEL_SMOOTH:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Select shading model: smooth&quot;</span>));</div>
<div class="line">        setShadingModel(ShadingModel::SMOOTH);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::CYCLE_POLYGON_MODE:</div>
<div class="line">        {</div>
<div class="line">          dumpCommand(MESSAGE(<span class="stringliteral">&quot;Cycle polygon mode&quot;</span>));</div>
<div class="line">          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> polygonMode = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(this-&gt;polygonMode) + 1;</div>
<div class="line">          <span class="keywordflow">if</span> (polygonMode &gt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(PolygonMode::LAST_MODE)) {</div>
<div class="line">            polygonMode = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(PolygonMode::FIRST_MODE);</div>
<div class="line">          }</div>
<div class="line">          setPolygonMode(<span class="keyword">static_cast&lt;</span>PolygonMode::Mode<span class="keyword">&gt;</span>(polygonMode));</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_POLYGON_MODE_FILL:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Select polygon mode: fill&quot;</span>));</div>
<div class="line">        setPolygonMode(PolygonMode::FILL);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_POLYGON_MODE_LINE:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Select polygon mode: line&quot;</span>));</div>
<div class="line">        setPolygonMode(PolygonMode::LINE);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_POLYGON_MODE_POINT:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Select polygon mode: point&quot;</span>));</div>
<div class="line">        setPolygonMode(PolygonMode::POINT);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::BLENDING_ENABLE:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Enable blending&quot;</span>));</div>
<div class="line">        setBlending(<span class="keyword">true</span>);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::BLENDING_DISABLE:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Disable blending&quot;</span>));</div>
<div class="line">        setBlending(<span class="keyword">false</span>);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::LIGHTING_ENABLE:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Enable lighting&quot;</span>));</div>
<div class="line">        setLighting(<span class="keyword">true</span>);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::LIGHTING_DISABLE:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Disable lighting&quot;</span>));</div>
<div class="line">        setLighting(<span class="keyword">false</span>);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::RESET_VIEW_PARAMETERS:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Reset view parameters&quot;</span>));</div>
<div class="line">        resetViewParameters();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::ROTATE_AROUND_X_AXIS_NEG:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Rotate around X axis (neg)&quot;</span>));</div>
<div class="line">        setRotation(view.getRotation() + Vector3D&lt;long double&gt;(-1.0, 0, 0));</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::ROTATE_AROUND_X_AXIS_POS:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Rotate around X axis (pos)&quot;</span>));</div>
<div class="line">        setRotation(view.getRotation() + Vector3D&lt;long double&gt;(1.0, 0, 0));</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::ROTATE_AROUND_Y_AXIS_NEG:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Rotate around Y axis (neg)&quot;</span>));</div>
<div class="line">        setRotation(view.getRotation() + Vector3D&lt;long double&gt;(0, -1.0, 0));</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::ROTATE_AROUND_Y_AXIS_POS:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Rotate around Y axis (pos)&quot;</span>));</div>
<div class="line">        setRotation(view.getRotation() + Vector3D&lt;long double&gt;(0, 1.0, 0));</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::ROTATE_AROUND_Z_AXIS_NEG:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Rotate around Z axis (neg)&quot;</span>));</div>
<div class="line">        setRotation(view.getRotation() + Vector3D&lt;long double&gt;(0, 0, -1.0));</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::ROTATE_AROUND_Z_AXIS_POS:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Rotate around Z axis (pos)&quot;</span>));</div>
<div class="line">        setRotation(view.getRotation() + Vector3D&lt;long double&gt;(0, 0, 1.0));</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::TRANSLATE_ALONG_X_NEG:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Translate along X axis (neg)&quot;</span>));</div>
<div class="line">        setTranslation(view.getTranslation() + Vector3D&lt;long double&gt;(-0.1, 0, 0));</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::TRANSLATE_ALONG_X_POS:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Translate along X axis (pos)&quot;</span>));</div>
<div class="line">        setTranslation(view.getTranslation() + Vector3D&lt;long double&gt;(0.1, 0, 0));</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::TRANSLATE_ALONG_Y_NEG:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Translate along Y axis (neg)&quot;</span>));</div>
<div class="line">        setTranslation(view.getTranslation() + Vector3D&lt;long double&gt;(0, -0.1, 0));</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::TRANSLATE_ALONG_Y_POS:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Translate along Y axis (pos)&quot;</span>));</div>
<div class="line">        setTranslation(view.getTranslation() + Vector3D&lt;long double&gt;(0, 0.1, 0));</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::TRANSLATE_ALONG_Z_NEG:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Translate along Z axis (neg)&quot;</span>));</div>
<div class="line">        setTranslation(view.getTranslation() + Vector3D&lt;long double&gt;(0, 0, -0.1));</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::TRANSLATE_ALONG_Z_POS:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Translate along Z axis (pos)&quot;</span>));</div>
<div class="line">        setTranslation(view.getTranslation() + Vector3D&lt;long double&gt;(0, 0, 0.1));</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_MODE_DEFAULT:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Select view mode: default&quot;</span>));</div>
<div class="line">        setMode(MODE_DEFAULT);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_MODE_SYSTEM:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Select view mode: system&quot;</span>));</div>
<div class="line">        setMode(MODE_SYSTEM);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_MODE_FLOOR:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Select view mode: floor&quot;</span>));</div>
<div class="line">        setMode(MODE_FLOOR);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_MODE_CUBE:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Select view mode: cube&quot;</span>));</div>
<div class="line">        setMode(MODE_CUBE);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_MODE_CONE:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Select view mode: cone&quot;</span>));</div>
<div class="line">        setMode(MODE_SYSTEM);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_MODE_TORUS:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Select view mode: torus&quot;</span>));</div>
<div class="line">        setMode(MODE_TORUS);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_MODE_INTENSITY:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Select view mode: image&quot;</span>));</div>
<div class="line">        setMode(MODE_INTENSITY);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_MODE_RGB_CLOUD:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Select view mode: RGB cloud&quot;</span>));</div>
<div class="line">        setMode(MODE_RGB_CLOUD);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_QUALITY_WORST:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Select quality: worst&quot;</span>));          </div>
<div class="line">        setQuality(QUALITY_WORST);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_QUALITY_NORMAL:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Select quality: normal&quot;</span>));</div>
<div class="line">        setQuality(QUALITY_NORMAL);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> Command::SELECT_QUALITY_BEST:</div>
<div class="line">        dumpCommand(MESSAGE(<span class="stringliteral">&quot;Select quality: best&quot;</span>));</div>
<div class="line">        setQuality(QUALITY_BEST);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">if</span> (verbosity &gt;= Verbosity::WARNINGS) {</div>
<div class="line">          fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Command &#39;&quot;</span>) &lt;&lt; identifier &lt;&lt; MESSAGE(<span class="stringliteral">&quot;&#39; is not supported&quot;</span>) &lt;&lt; ENDL;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">void</span> main() noexcept {</div>
<div class="line">    fout &lt;&lt; getFormalName() &lt;&lt; MESSAGE(<span class="stringliteral">&quot; version &quot;</span>) &lt;&lt; MAJOR_VERSION &lt;&lt; <span class="charliteral">&#39;.&#39;</span> &lt;&lt; MINOR_VERSION &lt;&lt; EOL</div>
<div class="line">         &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Generic Image Processing Framework (Test Suite)&quot;</span>) &lt;&lt; EOL</div>
<div class="line">         &lt;&lt; ENDL;</div>
<div class="line">    </div>
<div class="line">    MyOpenGLContext::Format desiredFormat;</div>
<div class="line">    <span class="keywordtype">int</span> formatId = -1;</div>
<div class="line">    </div>
<div class="line">    Array&lt;MyOpenGLContext::Format&gt; formats = MyOpenGLContext::getFormats(</div>
<div class="line">      OpenGLContext::RGB |</div>
<div class="line">      OpenGLContext::DOUBLE_BUFFERED |</div>
<div class="line">      OpenGLContext::DEPTH |</div>
<div class="line">      OpenGLContext::DIRECT</div>
<div class="line">    );</div>
<div class="line">    Array&lt;MyOpenGLContext::Format&gt;::ReadEnumerator enu = formats.getReadEnumerator();</div>
<div class="line">    </div>
<div class="line">    fout &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Available formats:&quot;</span>) &lt;&lt; ENDL;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; enu.hasNext(); ++i) {</div>
<div class="line">      <span class="keyword">const</span> MyOpenGLContext::Format* format = enu.next();</div>
<div class="line">      <span class="keywordflow">if</span> (<span class="keyword">false</span>) {</div>
<div class="line">        fout &lt;&lt; indent(2) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Format: &quot;</span>) &lt;&lt; i &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(4) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;color indexed: &quot;</span>)</div>
<div class="line">             &lt;&lt; ((format-&gt;flags &amp; MyOpenGLContext::COLOR_INDEXED) != 0) &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(4) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;rgb: &quot;</span>)</div>
<div class="line">             &lt;&lt; ((format-&gt;flags &amp; MyOpenGLContext::RGB) != 0) &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(4) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;double buffered: &quot;</span>)</div>
<div class="line">             &lt;&lt; ((format-&gt;flags &amp; MyOpenGLContext::DOUBLE_BUFFERED) != 0) &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(4) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;stereoscopic: &quot;</span>)</div>
<div class="line">             &lt;&lt; ((format-&gt;flags &amp; MyOpenGLContext::STEREO) != 0) &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(4) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;generic: &quot;</span>)</div>
<div class="line">             &lt;&lt; ((format-&gt;flags &amp; MyOpenGLContext::GENERIC) != 0) &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(4) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;color bits: &quot;</span>) &lt;&lt; format-&gt;colorBits &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(6) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;red bits: &quot;</span>) &lt;&lt; format-&gt;redBits &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(6) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;green bits: &quot;</span>) &lt;&lt; format-&gt;greenBits &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(6) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;blue bits: &quot;</span>) &lt;&lt; format-&gt;blueBits &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(6) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;alpha bits: &quot;</span>) &lt;&lt; format-&gt;alphaBits &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(4) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;accumulator bits: &quot;</span>) &lt;&lt; format-&gt;accumulatorBits &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(6) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;accumulator red bits: &quot;</span>) &lt;&lt; format-&gt;accumulatorRedBits &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(6) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;accumulator green bits: &quot;</span>) &lt;&lt; format-&gt;accumulatorGreenBits &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(6) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;accumulator blue bits: &quot;</span>) &lt;&lt; format-&gt;accumulatorBlueBits &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(6) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;accumulator alpha bits: &quot;</span>) &lt;&lt; format-&gt;accumulatorAlphaBits &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(4) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;depthBits: &quot;</span>) &lt;&lt; format-&gt;depthBits &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(4) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;stencilBits: &quot;</span>) &lt;&lt; format-&gt;stencilBits &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; indent(4) &lt;&lt; MESSAGE(<span class="stringliteral">&quot;auxBuffers: &quot;</span>) &lt;&lt; format-&gt;auxBuffers &lt;&lt; EOL</div>
<div class="line">             &lt;&lt; ENDL;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">if</span> ((formatId == -1) || (format-&gt;alphaBits &amp;&amp; (!desiredFormat.alphaBits))) {</div>
<div class="line">        formatId = i;</div>
<div class="line">        desiredFormat = *format;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (formatId == -1) {</div>
<div class="line">      ferr &lt;&lt; MESSAGE(<span class="stringliteral">&quot;Format not available&quot;</span>) &lt;&lt; ENDL;</div>
<div class="line">      setExitCode(EXIT_CODE_ERROR);</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    MyOpenGLContext myOpenGLContext(</div>
<div class="line">      Application::getApplication()-&gt;getFormalName(),</div>
<div class="line">      Position(64, 64),</div>
<div class="line">      Dimension(256, 256),</div>
<div class="line">      desiredFormat</div>
<div class="line">    );</div>
<div class="line">    </div>
<div class="line">    myOpenGLContext.show();</div>
<div class="line">    myOpenGLContext.raise();</div>
<div class="line">    myOpenGLContext.dispatch();</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">APPLICATION_STUB(ViewerApplication);</div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="anamespacegip_html_a03c358773288fce89e6dad2bab7fa018"><div class="ttname"><a href="namespacegip.html#a03c358773288fce89e6dad2bab7fa018">gip::forEach</a></div><div class="ttdeci">void forEach(const IMAGE &amp;image, UNOPR &amp;function) noexcept</div><div class="ttdoc">Invokes the operation for each element of the image.</div><div class="ttdef"><b>Definition:</b> traverse.h:38</div></div>
<div class="ttc" id="aclassgip_1_1_version_html"><div class="ttname"><a href="classgip_1_1_version.html">gip::Version</a></div><div class="ttdoc">Framework information.</div><div class="ttdef"><b>Definition:</b> Version.h:39</div></div>
<div class="ttc" id="anamespacegip_html_a1d0985f6db537856ed8c7eef93b6fd68"><div class="ttname"><a href="namespacegip.html#a1d0985f6db537856ed8c7eef93b6fd68">gip::ColorPixel</a></div><div class="ttdeci">RGBPixel&lt; uint8 &gt; ColorPixel</div><div class="ttdef"><b>Definition:</b> RGBPixel.h:105</div></div>
<div class="ttc" id="aclassgip_1_1_version_html_a8695d6c7b3a6ea08300fd903b63b1cdd"><div class="ttname"><a href="classgip_1_1_version.html#a8695d6c7b3a6ea08300fd903b63b1cdd">gip::Version::getBanner</a></div><div class="ttdeci">String getBanner() const noexcept</div></div>
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"></address>
</body>
</html>
